services:
    _defaults:
        public: true

    prestashop.translation.provider.factory.back:
        class: PrestaShopBundle\Translation\Provider\Factory\BackProviderFactory
        arguments:
            - "@prestashop.translation.loader.database"
            - "%translations_dir%"

    prestashop.translation.provider.factory.front:
        class: PrestaShopBundle\Translation\Provider\Factory\FrontProviderFactory
        arguments:
            - "@prestashop.translation.loader.database"
            - "%translations_dir%"

    prestashop.translation.provider.factory.mails_body:
        class: PrestaShopBundle\Translation\Provider\Factory\MailsBodyProviderFactory
        arguments:
            - "@prestashop.translation.loader.database"
            - "%translations_dir%"

    prestashop.translation.provider.factory.mails:
        class: PrestaShopBundle\Translation\Provider\Factory\MailsProviderFactory
        arguments:
            - "@prestashop.translation.loader.database"
            - "%translations_dir%"

    prestashop.translation.provider.factory.others:
        class: PrestaShopBundle\Translation\Provider\Factory\OthersProviderFactory
        arguments:
            - "@prestashop.translation.loader.database"
            - "%translations_dir%"

    prestashop.translation.provider.factory.modules:
        class: PrestaShopBundle\Translation\Provider\Factory\ModulesProviderFactory
        arguments:
            - "@prestashop.translation.loader.database"
            - "%modules_dir%"
            - "%translations_dir%"
            - "@prestashop.translation.loader.legacy_file"
            - "@prestashop.translation.extractor.legacy_module"

    prestashop.translation.provider.factory.search:
        class: PrestaShopBundle\Translation\Provider\Factory\SearchProviderFactory
        arguments:
            - "@prestashop.translation.loader.database"
            - "@prestashop.translation.loader.legacy_file"
            - "@prestashop.translation.extractor.legacy_module"
            - "%translations_dir%"

    prestashop.translation.provider.factory.themes:
        class: PrestaShopBundle\Translation\Provider\Factory\ThemesProviderFactory
        arguments:
            - "@prestashop.translation.loader.database"
            - "@prestashop.translation.extractor.theme_cache"
            - "@prestashop.core.addon.theme.repository"
            - "@filesystem"
            - "%themes_dir%"
            - "%translations_dir%"

    prestashop.translation.provider_factory:
        class: PrestaShopBundle\Translation\Provider\Factory\ProviderFactory
        arguments:
            -
                - "@prestashop.translation.provider.factory.back"
                - "@prestashop.translation.provider.factory.front"
                - "@prestashop.translation.provider.factory.mails_body"
                - "@prestashop.translation.provider.factory.mails"
                - "@prestashop.translation.provider.factory.others"
                - "@prestashop.translation.provider.factory.modules"
                - "@prestashop.translation.provider.factory.search"
                - "@prestashop.translation.provider.factory.themes"

    prestashop.translation.provider.translation_catalogue:
        class: PrestaShopBundle\Translation\Provider\TranslationsCatalogueProvider
        arguments:
            - "@prestashop.translation.provider_factory"

    # TRANSLATIONS
    prestashop.translation.loader.database:
        class: PrestaShopBundle\Translation\Loader\DatabaseTranslationLoader
        arguments:
            - "@doctrine.orm.entity_manager"
        tags:
            - {name: translation.loader, alias: db}

    prestashop.translation.loader.sql:
        class: PrestaShopBundle\Translation\Loader\SqlTranslationLoader
        tags:
            - {name: translation.loader, alias: db}

    prestashop.translation.reader.legacy_file:
        class: PrestaShopBundle\Translation\Loader\LegacyFileReader
        arguments:
            - "@prestashop.core.translation.locale.converter"

    prestashop.translation.loader.legacy_file:
      class: PrestaShopBundle\Translation\Loader\LegacyFileLoader
      arguments:
          - "@prestashop.translation.reader.legacy_file"
      tags:
          - {name: translation.loader, alias: legacy_files}

    # cannot decorate the original one because it is loaded later
    # this version activates loading legacy wordings in smarty files
    prestashop.translation.extractor.smarty.legacy:
        class: PrestaShop\TranslationToolsBundle\Translation\Extractor\SmartyExtractor
        arguments:
            - "@prestashop.compiler.smarty.template"
            - true

    prestashop.translation.extractor.theme:
        class: PrestaShopBundle\Translation\Extractor\ThemeExtractor
        arguments:
            - "@prestashop.translation.extractor.smarty.legacy"

    prestashop.translation.extractor.theme_cache:
        class: PrestaShopBundle\Translation\Extractor\ThemeExtractorCache
        arguments:
            - "@prestashop.translation.extractor.theme"
            - "%themes_translations_dir%"

    prestashop.translation.extractor.legacy_module:
        class: PrestaShopBundle\Translation\Extractor\LegacyModuleExtractor
        arguments:
            - "@prestashop.translation.extractor.php"
            - "@prestashop.translation.extractor.smarty.legacy"
            - "@prestashop.translation.extractor.twig"
            - "%modules_dir%"

    prestashop.translation.dumper.xliff:
        class: PrestaShop\TranslationToolsBundle\Translation\Dumper\XliffFileDumper

    prestashop.translation.exporter.theme:
        class: PrestaShopBundle\Translation\Exporter\ThemeExporter
        arguments:
            - "@prestashop.translation.extractor.theme_cache"
            - "@prestashop.core.addon.theme.repository"
            - "@prestashop.translation.provider_factory"
            - "@prestashop.translation.dumper.xliff"
            - "@prestashop.utils.zip_manager"
            - "@filesystem"
        properties:
            cacheDir: "%kernel.cache_dir%"
        calls:
            - [ setExportDir, ["%kernel.cache_dir%/export"]]

    # Api - i18n
    prestashop.translation.api:
        abstract: true
        class: PrestaShopBundle\Translation\Api\AbstractApi
        calls:
            - [setTranslator, ['@translator']]

    prestashop.translation.api.stock:
        class: PrestaShopBundle\Translation\Api\StockApi
        parent: prestashop.translation.api
        public: true

    prestashop.translation.api.international:
        class: PrestaShopBundle\Translation\Api\InternationalApi
        parent: prestashop.translation.api
        public: true
