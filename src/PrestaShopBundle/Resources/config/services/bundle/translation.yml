services:
    _defaults:
        public: true

    prestashop.translation.back_provider_factory:
        class: PrestaShopBundle\Translation\Provider\Factory\BackProviderFactory
        arguments:
            - "@prestashop.translation.database_loader"
            - "%translations_dir%"

    prestashop.translation.front_provider_factory:
        class: PrestaShopBundle\Translation\Provider\Factory\FrontProviderFactory
        arguments:
            - "@prestashop.translation.database_loader"
            - "%translations_dir%"

    prestashop.translation.mails_body_provider_factory:
        class: PrestaShopBundle\Translation\Provider\Factory\MailsBodyProviderFactory
        arguments:
            - "@prestashop.translation.database_loader"
            - "%translations_dir%"

    prestashop.translation.mails_provider_factory:
        class: PrestaShopBundle\Translation\Provider\Factory\MailsProviderFactory
        arguments:
            - "@prestashop.translation.database_loader"
            - "%translations_dir%"

    prestashop.translation.others_provider_factory:
        class: PrestaShopBundle\Translation\Provider\Factory\OthersProviderFactory
        arguments:
            - "@prestashop.translation.database_loader"
            - "%translations_dir%"

    prestashop.translation.modules_provider_factory:
        class: PrestaShopBundle\Translation\Provider\Factory\ModulesProviderFactory
        arguments:
            - "@prestashop.translation.database_loader"
            - "%modules_dir%"
            - "%translations_dir%"
            - "@prestashop.translation.legacy_file_loader"
            - "@prestashop.translation.legacy_module.extractor"

    prestashop.translation.search_provider_factory:
        class: PrestaShopBundle\Translation\Provider\Factory\SearchProviderFactory
        arguments:
            - "@prestashop.translation.database_loader"
            - "@prestashop.translation.legacy_file_loader"
            - "@prestashop.translation.legacy_module.extractor"
            - "%translations_dir%"

    prestashop.translation.themes_provider_factory:
        class: PrestaShopBundle\Translation\Provider\Factory\ThemesProviderFactory
        arguments:
            - "@prestashop.translation.frontoffice_provider"
            - "@prestashop.translation.database_loader"
            - "@prestashop.translation.theme_extractor_cache"
            - "@prestashop.core.addon.theme.repository"
            - "@filesystem"
            - "%themes_dir%"

    prestashop.translation.provider_factory:
        class: PrestaShopBundle\Translation\Provider\Factory\ProviderFactory
        arguments:
            -
                - "@prestashop.translation.back_provider_factory"
                - "@prestashop.translation.front_provider_factory"
                - "@prestashop.translation.mails_body_provider_factory"
                - "@prestashop.translation.mails_provider_factory"
                - "@prestashop.translation.others_provider_factory"
                - "@prestashop.translation.modules_provider_factory"
                - "@prestashop.translation.search_provider_factory"
                - "@prestashop.translation.themes_provider_factory"

    prestashop.translation.translation_catalogue_provider:
        class: PrestaShopBundle\Translation\Provider\TranslationsCatalogueProvider
        arguments:
            - "@prestashop.translation.provider_factory"

    #TRANSLATIONS PROVIDERS
    prestashop.translation.frontoffice_provider:
        class: PrestaShopBundle\Translation\Provider\FrontOfficeProvider
        arguments:
            - "@prestashop.translation.database_loader"
            - "%translations_dir%"
        tags:
            - { name: "ps.translation_provider" }

    # TRANSLATIONS
    prestashop.translation.database_loader:
        class: PrestaShopBundle\Translation\Loader\DatabaseTranslationLoader
        arguments:
            - "@doctrine.orm.entity_manager"
        tags:
            - {name: translation.loader, alias: db}

    prestashop.translation.sql_loader:
        class: PrestaShopBundle\Translation\Loader\SqlTranslationLoader
        tags:
            - {name: translation.loader, alias: db}

    prestashop.translation.legacy_file_reader:
        class: PrestaShopBundle\Translation\Loader\LegacyFileReader
        arguments:
            - "@prestashop.core.translation.locale.converter"

    prestashop.translation.legacy_file_loader:
      class: PrestaShopBundle\Translation\Loader\LegacyFileLoader
      arguments:
          - "@prestashop.translation.legacy_file_reader"
      tags:
          - {name: translation.loader, alias: legacy_files}

    # cannot decorate the original one because it is loaded later
    # this version activates loading legacy wordings in smarty files
    prestashop.translation.extractor.smarty.legacy:
        class: PrestaShop\TranslationToolsBundle\Translation\Extractor\SmartyExtractor
        arguments:
            - "@prestashop.compiler.smarty.template"
            - true

    prestashop.translation.theme_extractor:
        class: PrestaShopBundle\Translation\Extractor\ThemeExtractor
        arguments:
            - "@prestashop.translation.extractor.smarty.legacy"

    prestashop.translation.theme_extractor_cache:
        class: PrestaShopBundle\Translation\Extractor\ThemeExtractorCache
        arguments:
            - "@prestashop.translation.theme_extractor"
            - "%themes_translations_dir%"

    prestashop.translation.legacy_module.extractor:
        class: PrestaShopBundle\Translation\Extractor\LegacyModuleExtractor
        arguments:
            - "@prestashop.translation.extractor.php"
            - "@prestashop.translation.extractor.smarty.legacy"
            - "@prestashop.translation.extractor.twig"
            - "%modules_dir%"

    prestashop.translation.dumper.xliff:
        class: PrestaShop\TranslationToolsBundle\Translation\Dumper\XliffFileDumper

    prestashop.translation.theme.exporter:
        class: PrestaShopBundle\Translation\Exporter\ThemeExporter
        arguments:
            - "@prestashop.translation.theme_extractor_cache"
            - "@prestashop.core.addon.theme.repository"
            - "@prestashop.translation.provider_factory"
            - "@prestashop.translation.dumper.xliff"
            - "@prestashop.utils.zip_manager"
            - "@filesystem"
        properties:
            cacheDir: "%kernel.cache_dir%"
        calls:
            - [ setExportDir, ["%kernel.cache_dir%/export"]]

    # Api - i18n
    prestashop.translation.api:
        abstract: true
        class: PrestaShopBundle\Translation\Api\AbstractApi
        calls:
            - [setTranslator, ['@translator']]

    prestashop.translation.api.stock:
        class: PrestaShopBundle\Translation\Api\StockApi
        parent: prestashop.translation.api
        public: true

    prestashop.translation.api.international:
        class: PrestaShopBundle\Translation\Api\InternationalApi
        parent: prestashop.translation.api
        public: true
