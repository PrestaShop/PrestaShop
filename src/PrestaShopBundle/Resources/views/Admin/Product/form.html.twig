{% extends 'PrestaShopBundle:Admin:layout.html.twig' %}

{% block content %}

  <form name="form" id="form" method="post" class="form-horizontal product-page row" novalidate="novalidate">

    {# PRODUCT HEADER #}
    <div class="product-header">
      {% if is_multishop_context %}
        <div class="col-md-12">
          <div class="alert alert-warning" role="alert">
            <i class="material-icons">info_outline</i><p class="alert-text">{{ trans('Be carefull, you are in a multishop context, all modifcation will be apply to each shop or group shop', {}, 'AdminProducts') }}</p>
          </div>
        </div>
      {% endif %}

      <div class="col-md-10 col-md-offset-1">
        <div class="row">
          <div class="col-md-7 big-input">
            {{ form_widget(form.step1.name) }}
          </div>
          <div class="col-md-2 form_step1_type_product">
            {{ form_widget(form.step1.type_product) }}
          </div>
          <div class="col-md-1 form_switch_language {{ languages|length == 1 ? 'hide' : '' }}">
            <select id="form_switch_language" class="form-control" data-toggle="select2">
              {% for language in languages %}
                <option value="{{ language.iso_code }}" {% if default_language_iso == language.iso_code %}selected="selected"{% endif %}>{{ language.iso_code }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-lg-2 text-md-right">
            <a class="toolbar-button btn-sales" href="{{ stats_link }}" target="_blank" title="{{ trans('Sales', [], 'AdminTab') }}"
               id="product_form_go_to_sales">
              <i class="material-icons">assessment</i>
              <span class="title">{{ trans('Sales', {}, 'AdminProducts') }}</span>
            </a>

            <a
              class="toolbar-button btn-quicknav btn-sidebar"
              href="#"
              title="{{ trans('Quick navigation', [], 'AdminTab') }}"
              data-toggle="sidebar"
              data-target="#right-sidebar"
              data-url="{{ path('admin_product_list', {limit: 'last', offset: 'last', view: 'quicknav'}) }}"
              id="product_form_open_quicknav"
            >
              <i class="material-icons">list</i>
              <span class="title">{{ trans('Product list', {}, 'AdminProducts') }}</span>
            </a>

            <a class="toolbar-button btn-help btn-sidebar" href="#"
               title="{{ trans('Help', [], 'AdminTab') }}"
               data-toggle="sidebar"
               data-target="#right-sidebar"
               data-url="{{ help_link }}"
               id="product_form_open_help"
            >
              <i class="material-icons">help</i>
              <span class="title">{{ trans('Help', {}, 'AdminProducts') }}</span>
            </a>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12">
            {{ form_errors(form.step1.name) }}
            {{ form_errors(form.step1.type_product) }}
          </div>
        </div>
      </div>
      <div class="clearfix"></div>
    </div>

    <div class="col-md-10 col-md-offset-1">
      <div id="form_bubbling_errors">
        {{ form_errors(form) }}
      </div>
    </div>

    {# FORM TABS CONTAINER #}
    <div id="form-loading" class="col-md-10 col-md-offset-1">

      <ul class="nav nav-tabs" id="form-nav" role="tablist">
        <li id="tab_step1" class="nav-item"><a href="#step1" role="tab" data-toggle="tab" class="nav-link active">{{ trans('Basic settings', {}, 'AdminProducts') }}</a></li>
        <li id="tab_step3" class="nav-item"><a href="#step3" role="tab" data-toggle="tab" class="nav-link">{{ trans('Quantities', {}, 'AdminProducts') }}</a></li>
        <li id="tab_step4" class="nav-item"><a href="#step4" role="tab" data-toggle="tab" class="nav-link">{{ trans('Shipping', {}, 'AdminProducts') }}</a></li>
        <li id="tab_step2" class="nav-item"><a href="#step2" role="tab" data-toggle="tab" class="nav-link">{{ trans('Pricing', {}, 'AdminProducts') }}</a></li>
        <li id="tab_step5" class="nav-item"><a href="#step5" role="tab" data-toggle="tab" class="nav-link">{{ trans('SEO', {}, 'AdminProducts') }}</a></li>
        <li id="tab_step6" class="nav-item"><a href="#step6" role="tab" data-toggle="tab" class="nav-link">{{ trans('Options', {}, 'AdminProducts') }}</a></li>
        {% if hookcount('displayAdminProductsExtra') > 0 %}
          <li id="tab_hooks" class="nav-item"><a href="#hooks" role="tab" data-toggle="tab" class="nav-link">&laquo;{{ trans('Modules options', {}, 'AdminProducts') }}&raquo;</a></li>
        {% endif %}
      </ul>

      <div id="form_content" class="tab-content">

        {# STEP 1 #}
        <div role="tabpanel" class="form-contenttab tab-pane active" id="step1">
          <div class="row">
            <div class="col-md-12">
              <div class="container-fluid">
                <div class="row">

                  {# LEFT #}
                  <div class="col-md-9">

                    <div id="js_form_step1_inputPackItems">
                      {{ form_errors(form.step1.inputPackItems) }}
                      {{ form_widget(form.step1.inputPackItems) }}
                    </div>

                    <div id="product-images-container" class="m-b-2">
                      <div id="product-images-dropzone" class="panel dropzone ui-sortable" url-upload="{{ path('admin_product_image_upload') }}" url-position="{{ path('admin_product_image_positions') }}" url-update="{{ path('admin_product_image_form') }}" url-delete="{{ path('admin_product_image_delete') }}" data-max-size="{{ 'PS_ATTACHMENT_MAXIMUM_SIZE'|configuration }}">
                        <div id="product-images-dropzone-error" class="text-danger"></div>
                        {% if form.step1.vars.value.images is defined %}
                          {% if form.step1.vars.value.images|length > 0 %}
                            <div class="dz-preview disabled openfilemanager">
                              <div><span>+</span></div>
                            </div>
                          {% endif %}
                          {% for image in form.step1.vars.value.images %}
                            <div class="dz-preview dz-processing dz-image-preview dz-complete ui-sortable-handle" data-id="{{ image.id }}">
                              <div class="dz-image bg" style="background-image: url('{{ image.base_image_url }}-home_default.{{ image.format }}');"></div>
                              <div class="dz-details">
                                <div class="dz-size"><span data-dz-size=""></span></div>
                                <div class="dz-filename"><span data-dz-name=""></span></div>
                              </div>
                              <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress="" style="width: 100%;"></span></div>
                              <div class="dz-error-message"><span data-dz-errormessage=""></span></div>
                              <div class="dz-success-mark"></div>
                              <div class="dz-error-mark"></div>
                              {% if image.cover %}
                                <div class="iscover">{{ trans('Cover', {}, 'AdminProducts') }}</div>
                              {% endif %}
                            </div>
                          {% endfor %}
                        {% endif %}
                      </div>
                      <div class="dropzone-expander text-xs-center">
                        <span class="expand">{{ trans('View all images', {}, 'AdminProducts') }}</span>
                        <span class="compress">{{ trans('View less', {}, 'AdminProducts') }}</span>
                      </div>
                      <div id="product-images-form-container" class="col-lg-5 panel">
                        <div id="product-images-form" class="col-lg-12"></div>
                      </div>
                    </div>

                    <ul class="nav nav-tabs">
                      <li id="tab_description_short" class="nav-item"><a href="#description_short" data-toggle="tab" class="nav-link active">{{ trans('Summary', {}, 'AdminProducts') }}</a></li>
                      <li id="tab_description" class="nav-item"><a href="#description" data-toggle="tab" class="nav-link">{{ trans('Description', {}, 'AdminProducts') }}</a></li>
                    </ul>

                    <div class="tab-content">
                      <div class="tab-pane panel panel-default active" id="description_short">
                        {{ form_widget(form.step1.description_short) }}
                      </div>
                      <div class="tab-pane panel panel-default " id="description">
                        {{ form_widget(form.step1.description) }}
                      </div>
                    </div>

                    <div id="features" class="m-b-1">
                      <div id="features-content" class="content {{ form.step1.features|length == 0 ? 'hide':'' }}">
                        <h2>{{ trans('Features', [], 'AdminProducts') }}</h2>
                        {{ form_errors(form.step1.features) }}
                        <div
                          class="feature-collection nostyle"
                          data-prototype="{% filter escape %}
                            {{ include('PrestaShopBundle:Admin/Product/Include:form_feature.html.twig', { 'form': form.step1.features.vars.prototype }) }}
                          {% endfilter %}"
                        >
                          {% for feature in form.step1.features %}
                            {{ include('PrestaShopBundle:Admin/Product/Include:form_feature.html.twig', { 'form': feature }) }}
                          {% endfor %}
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-4">
                          <a href="#" class="btn btn-action btn-block text-md-left add" id="add_feature_button">
                            <i class="material-icons">add</i>
                            {{ trans('Add a feature', {}, 'AdminProducts') }}
                          </a>
                        </div>
                      </div>
                    </div>

                    <div id="manufacturer" class="m-b-1">
                      <div id="manufacturer-content" class="row {{ form.step1.id_manufacturer.vars.value == '' ? 'hide':'' }}">
                        <div class="col-md-12">
                          <h2>{{ trans("Brand", {}, 'AdminProducts') }}</h2>
                        </div>
                        <div class="col-md-8">
                          {{ form_errors(form.step1.id_manufacturer) }}
                        </div>
                        <div class="col-md-8">
                          {{ form_widget(form.step1.id_manufacturer) }}
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-4">
                          <a href="#" class="btn btn-action btn-block text-md-left open {{ form.step1.id_manufacturer.vars.value != '' ? 'hide':'' }}" id="add_brand_button">
                            <i class="material-icons">add</i>
                            {{ trans('Add a brand', {}, 'AdminProducts') }}
                          </a>
                        </div>
                      </div>
                    </div>

                    <div id="related-product" class="m-b-1">
                      <div id="related-content" class="row {{ form.step1.related_products.vars.value.data|length == 0 ? 'hide':'' }}">
                        <div class="col-md-12">
                          <h2>{{ trans("Related product", {}, 'AdminProducts') }}</h2>
                        </div>
                        <div class="col-md-8">
                          {{ form_errors(form.step1.related_products) }}
                        </div>
                        <div class="col-md-8">
                          {{ form_widget(form.step1.related_products) }}
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-4">
                          <a href="#" class="btn btn-action btn-block text-md-left open {{ form.step1.related_products.vars.value.data|length > 0 ? 'hide':'' }}">
                            <i class="material-icons">add</i>
                            {{ trans('Add a related product', {}, 'AdminProducts') }}
                          </a>
                        </div>
                      </div>
                    </div>

                  </div>

                  {# RIGHT #}
                  <div class="col-md-3">

                      <div class="row right-column">
                        <div class="col-md-12">

                          <div class="form-group" id="show_variations_selector">
                            <h2>
                              {{ trans("Product type", {}, 'AdminProducts') }}
                              <span
                                class="help-box"
                                data-toggle="tooltip"
                                title="{{ trans("Combinations: \n If you're selling a product with attributes that can be combined (color, size, capacity, ...), you will need to create combinations. \n Ex.: Size M in blue and size S in green are 2 different combinations of a t-shirt.",{}, 'AdminProducts')|raw }}"
                              ></span>
                            </h2>
                            <div class="radio">
                              <label>
                                <input type="radio" name="show_variations" value="0" {% if not has_combinations %}checked="checked"{% endif %}>
                                {{ trans("Simple product", {}, 'AdminProducts') }}
                              </label>
                            </div>
                            <div class="radio">
                              <label>
                                <input type="radio" name="show_variations" value="1" {% if has_combinations %}checked="checked"{% endif %}>
                                {{ trans("Product with combinations", {}, 'AdminProducts') }}
                              </label>
                              <div>
                                <span id="product_type_combinations_shortcut" class="small">
                                  <a href="#tab-step3" onclick="$('a[href=\'#step3\']').tab('show');">
                                    {{ trans("Advanced settings available in Combinations", {}, 'AdminProducts')|raw }}
                                  </a>
                                </span>
                              </div>
                            </div>
                          </div>

                          <div class="form-group" id="product_qty_0_shortcut_div">
                            <h2>{{ trans("Quantity", {}, 'AdminProducts') }}</h2>
                            {{ form_errors(form.step1.qty_0_shortcut) }}
                            <div class="row">
                              <div class="col-md-6">
                                {{ form_widget(form.step1.qty_0_shortcut) }}
                              </div>
                            </div>
                            <span class="small">
                              <a href="#tab-step3" onclick="$('a[href=\'#step3\']').tab('show');" class="external-link">
                                {{ trans("Advanced settings available in Quantities", {}, 'AdminProducts') }}
                              </a>
                            </span>
                          </div>

                          <div class="form-group">
                            <h2>{{ trans("Price", {}, 'AdminProducts') }}</h2>
                            <div class="row">
                              <div class="col-md-6">
                                <label class="form-control-label">{{ trans("Tax excl.", {}, 'AdminProducts') }}</label>
                                {{ form_widget(form.step1.price_shortcut) }}
                                {{ form_errors(form.step1.price_shortcut) }}
                              </div>
                              <div class="col-md-6 col-offset-md-1">
                                <label class="form-control-label">{{ trans("Tax incl.", {}, 'AdminProducts') }}</label>
                                {{ form_widget(form.step1.price_ttc_shortcut) }}
                                {{ form_errors(form.step1.price_ttc_shortcut) }}
                              </div>
                              <div class="col-md-12 m-t-1">
                                <label class="form-control-label">{{ trans("Tax rule", {}, 'AdminProducts') }}</label>
                                {{ render(controller('PrestaShopBundle:Admin/Product:renderField', {'productId': id_product, 'step': 'step2', 'fieldName': 'id_tax_rules_group' })) }}
                              </div>
                              <div class="col-md-12">
                                <span class="small">
                                  {{ trans("Advanced settings available in", {}, 'AdminProducts') }}
                                  <a href="#tab-step2" onclick="$('a[href=\'#step2\']').tab('show');" class="external-link">
                                    {{ trans("Pricing", {}, 'AdminProducts') }}
                                  </a>
                                </span>
                              </div>
                            </div>
                            <div class="row hide">
                              <div class="col-md-12">
                                <label>{{ trans("Tax rule", {}, 'AdminProducts') }}</label>
                              </div>
                              <div class="clearfix"></div>
                              <div class="col-md-11" id="tax_rule_shortcut">
                              </div>
                              <a href="#" onclick="$(this).parent().hide()">&times;</a>
                            </div>
                          </div>

                          <div class="form-group">
                            {{ include('PrestaShopBundle:Admin/Product/Include:form-categories.html.twig', { 'form': form.step1 }) }}
                          </div>
                        </div>
                      </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        {# STEP 2 #}
        <div role="tabpanel" class="form-contenttab tab-pane" id="step3">
          <div class="row">
            <div class="col-md-12">
              <div class="container-fluid">
                <div class="row">

                  <div class="col-md-12">

                    <div id="quantities" style="{% if has_combinations or form.step3.depends_on_stock.vars.value != "0" %}display: none;{% endif %}">
                      <h2>{{ trans('Quantities', [], 'AdminProducts') }}</h2>
                      <fieldset class="form-group">
                        <div class="row">
                          <div class="col-md-4">
                            <label class="form-control-label">{{ form.step3.qty_0.vars.label }}</label>
                            {{ form_errors(form.step3.qty_0) }}
                            {{ form_widget(form.step3.qty_0) }}
                          </div>
                          <div class="col-md-4">
                            <label class="form-control-label">{{ form.step3.minimal_quantity.vars.label }}</label>
                            {{ form_errors(form.step3.minimal_quantity) }}
                            {{ form_widget(form.step3.minimal_quantity) }}
                          </div>
                        </div>
                      </fieldset>
                    </div>

                    <div id="virtual_product" data-action="{{ path('admin_product_virtual_save_action') }}" data-action-remove="{{ path('admin_product_virtual_remove_action') }}">

                      <div class="row">
                        <div class="col-md-4">
                          <h2>{{ form.step3.virtual_product.vars.label }}</h2>
                        </div>
                        <div class="col-md-8">
                          <fieldset class="form-group">
                            {{ form_widget(form.step3.virtual_product.is_virtual_file) }}
                          </fieldset>
                        </div>
                      </div>

                      <div id="virtual_product_content" class="row col-md-8">
                        {{ form_errors(form.step3.virtual_product) }}
                        <div class="col-md-12">
                          <fieldset class="form-group">
                            <label class="form-control-label">{{ form.step3.virtual_product.file.vars.label }}</label>
                            <div id="form_step3_virtual_product_file_input" class="{{ form.step3.virtual_product.vars.value.filename is defined ? 'hide' : 'show' }}">
                              {{ form_widget(form.step3.virtual_product.file) }}
                            </div>
                            <div id="form_step3_virtual_product_file_details" class="{{ form.step3.virtual_product.vars.value.filename is defined ? 'show' : 'hide' }}">
                              <a href="{{ form.step3.virtual_product.vars.value.file_download_link is defined ? form.step3.virtual_product.vars.value.file_download_link : '' }}" class="btn btn-default btn-sm download">{{ trans('Download file', {}, 'AdminProducts') }}</a>
                              <a href="{{ path('admin_product_virtual_remove_file_action') }}" class="btn btn-danger btn-sm delete">{{ trans('Delete this file', {}, 'AdminProducts') }}</a>
                            </div>
                          </fieldset>
                        </div>
                        <div class="col-md-6">
                          <fieldset class="form-group">
                            <label class="form-control-label">{{ form.step3.virtual_product.name.vars.label }}</label>
                            {{ form_errors(form.step3.virtual_product.name) }}
                            {{ form_widget(form.step3.virtual_product.name) }}
                          </fieldset>
                        </div>
                        <div class="col-md-6">
                          <fieldset class="form-group">
                            <label class="form-control-label">{{ form.step3.virtual_product.nb_downloadable.vars.label }}</label>
                            {{ form_errors(form.step3.virtual_product.nb_downloadable) }}
                            {{ form_widget(form.step3.virtual_product.nb_downloadable) }}
                          </fieldset>
                        </div>
                        <div class="col-md-6">
                          <fieldset class="form-group">
                            <label class="form-control-label">{{ form.step3.virtual_product.expiration_date.vars.label }}</label>
                            {{ form_errors(form.step3.virtual_product.expiration_date) }}
                            {{ form_widget(form.step3.virtual_product.expiration_date) }}
                          </fieldset>
                        </div>
                        <div class="col-md-6">
                          <fieldset class="form-group">
                            <label class="form-control-label">{{ form.step3.virtual_product.nb_days.vars.label }}</label>
                            {{ form_errors(form.step3.virtual_product.nb_days) }}
                            {{ form_widget(form.step3.virtual_product.nb_days) }}
                          </fieldset>
                        </div>
                        <div class="col-md-12">
                          {{ form_widget(form.step3.virtual_product.save) }}
                        </div>
                      </div>
                    </div>

                    {% if asm_globally_activated and form.step1.type_product.vars.value != "2" %}
                      <div class="form-group" id="asm_quantity_management">
                        <label class="col-sm-2 control-label" for="form_step3_advanced_stock_management"></label>
                        <div class="col-sm-10">
                          {{ form_errors(form.step3.advanced_stock_management) }}
                          {{ form_widget(form.step3.advanced_stock_management) }}
                          {% if form.step1.type_product.vars.value == "1" %}
                            {{ trans('When enabling advanced stock management for a pack, please make sure it is also enabled for its product(s) â€“ if you choose to decrement product quantities.', {}, 'AdminProducts') }}
                          {% endif %}
                        </div>
                      </div>
                      <div class="form-group" id="depends_on_stock_div" style="{% if not(form.step3.advanced_stock_management.vars.checked) %}display: none;{% endif %}">
                        <label class="col-sm-2 control-label" for="form_step3_depends_on_stock"></label>
                        <div class="col-sm-10">
                          {{ form_errors(form.step3.depends_on_stock) }}
                          {{ form_widget(form.step3.depends_on_stock) }}
                        </div>
                      </div>
                    {% endif %}

                    <div id="pack_stock_type">
                      <h2>{{ form.step3.pack_stock_type.vars.label }}</h2>
                      <div class="row col-md-4">
                        <fieldset class="form-group">
                          {{ form_errors(form.step3.pack_stock_type) }}
                          {{ form_widget(form.step3.pack_stock_type) }}
                        </fieldset>
                      </div>
                    </div>

                    <div id="combinations">
                      <h2>
                        {{ trans('Product combinations', [], 'AdminProducts') }}
                        <span
                          class="help-box"
                          data-toggle="tooltip"
                          title="{{ trans("Creating combinations: \n Combinations are the different variations of a product, with attributes like its size, weight or color taking different values. To create a combination, you need to create your product attributes first. Go to Catalog > Product Attributes for this!", {}, 'AdminProducts')|raw }}"
                        ></span>
                      </h2>
                      <div id="attributes-generator">
                        <p>
                          {{ trans('Create a series of combinations by entering the related attributes below.', [], 'AdminProducts') }}
                        </p>
                        <div class="row">
                          <div class="col-md-10">
                            <fieldset class="form-group">
                              {{ form_errors(form.step3.attributes) }}
                              {{ form_widget(form.step3.attributes) }}
                            </fieldset>
                          </div>
                          <div class="col-md-2">
                            <button id="create-combinations" class="btn btn-action btn-block">
                              <i class="material-icons">add</i>
                              Create
                            </button>
                          </div>
                        </div>
                      </div>

                      <div>
                        {{ form_errors(form.step3.combinations) }}
                        <table class="table table-striped">
                          <thead id="combinations_thead" {% if form.step3.combinations|length == 0 %}style="display: none;"{% endif %}>
                          <tr class="uppercase">
                            <th></th>
                            <th>{{ trans('Combination', {}, 'AdminProducts') }}</th>
                            <th>{{ trans('Impact on price', {}, 'AdminProducts') }}</th>
                            <th>{{ trans('Impact on weight', {}, 'AdminProducts') }}</th>
                            <th>{{ trans('Quantity', {}, 'AdminProducts') }}</th>
                            <th></th>
                          </tr>
                          </thead>

                          <tbody class="panel-group accordion" id="accordion_combinations" data-action-delete-all="{{ path('admin_delete_all_attributes') }}" data-weight-unit="{{ 'PS_WEIGHT_UNIT'|configuration }}" data-action-refresh-images="{{ path('admin_get_form_images_combination') }}">
                          {% for combination in form.step3.combinations %}
                            {{ include('PrestaShopBundle:Admin/Product/Include:form_combination.html.twig', { 'form': combination, 'loop_index': loop.index0, 'id_product': id_product }) }}
                          {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>

                    <div class="form-group">
                      <div class="row">

                        <div class="col-md-12">
                          <h2>{{ trans('Availability preferences', [], 'AdminProducts') }}</h2>
                        </div>

                        <div class="col-md-12">
                          <label class="form-control-label">{{ trans('Behavior when out of stock', [], 'AdminProducts') }}</label>
                          {{ form_errors(form.step3.out_of_stock) }}
                          {{ form_widget(form.step3.out_of_stock) }}
                        </div>

                        <div class="col-md-4">
                            <label class="form-control-label">{{ form.step3.available_now.vars.label }}</label>
                            {{ form_errors(form.step3.available_now) }}
                            {{ form_widget(form.step3.available_now) }}
                        </div>
                        <div class="col-md-4 ">
                            <label class="form-control-label">{{ form.step3.available_later.vars.label }}</label>
                            {{ form_errors(form.step3.available_later) }}
                            {{ form_widget(form.step3.available_later) }}
                        </div>
                        <div class="col-md-4 ">
                          <label class="form-control-label">{{ form.step3.available_date.vars.label }}</label>
                          {{ form_errors(form.step3.available_date) }}
                          {{ form_widget(form.step3.available_date) }}
                        </div>

                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        {# STEP 3 #}
        <div role="tabpanel" class="form-contenttab tab-pane" id="step4">
          <div class="row">
            <div class="col-md-12">
              <div class="container-fluid">
                <div class="row">
                  {{ include('PrestaShopBundle:Admin/Product/Include:form_shipping.html.twig', {
                    'form' : form.step4,
                    'asm_globally_activated': asm_globally_activated,
                    'isNotVirtual': form.step1.type_product.vars.value != "2",
                    'isChecked': form.step3.advanced_stock_management.vars.checked,
                    'warehouses': warehouses
                  }) }}
                </div>
              </div>
            </div>
          </div>
        </div>

        {# STEP 4 #}
        <div role="tabpanel" class="form-contenttab tab-pane" id="step2">
          <div class="row">
            <div class="col-md-12">
              <div class="container-fluid">
                <div class="row">

                  <div class="col-md-12">
                    <h2>{{ trans('Retail price', {}, 'AdminProducts') }}</h2>
                  </div>

                  <div class="col-md-12 form-group">
                    <div class="row">

                      <div class="col-md-2">
                        <label class="form-control-label">{{ form.step2.price.vars.label }}</label>
                        {{ form_errors(form.step2.price) }}
                        {{ form_widget(form.step2.price) }}
                      </div>
                      <div class="col-md-2">
                        <label class="form-control-label">{{ form.step2.price_ttc.vars.label }}</label>
                        {{ form_errors(form.step2.price_ttc) }}
                        {{ form_widget(form.step2.price_ttc) }}
                      </div>

                      <div class="col-md-2 col-md-offset-1">
                        <label class="form-control-label">{{ form.step2.unit_price.vars.label }}</label>
                        {{ form_errors(form.step2.unit_price) }}
                        {{ form_widget(form.step2.unit_price) }}
                      </div>
                      <div class="col-md-2">
                        <label class="form-control-label">&nbsp;</label>
                        {{ form_errors(form.step2.unity) }}
                        {{ form_widget(form.step2.unity) }}
                      </div>

                      <div class="col-md-2 col-md-offset-1 {% if 'PS_USE_ECOTAX'|configuration != 1 %}hide{% endif %}">
                        <label class="form-control-label">{{ form.step2.ecotax.vars.label }}</label>
                        {{ form_errors(form.step2.ecotax) }}
                        {{ form_widget(form.step2.ecotax) }}
                      </div>

                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="row form-group">
                      <div class="col-md-4">
                        <label class="form-control-label">{{ form.step2.id_tax_rules_group.vars.label }}</label>
                        {{ form_errors(form.step2.id_tax_rules_group) }}
                        {{ form_widget(form.step2.id_tax_rules_group) }}
                      </div>
                      <div class="col-md-8">
                        <label class="form-control-label">&nbsp;</label>
                        <a class="form-control-static" href="{{ getAdminLink("AdminTaxes") }}">{{ trans('Manage tax rules', {}, 'AdminProducts') }}</a>
                      </div>
                      <div class="col-md-12 p-t-1">
                        {{ form_widget(form.step2.on_sale) }}
                      </div>
                      <div class="col-md-12">
                        <div class="row">
                          <div class="col-md-5">
                            <div class="alert alert-info" role="alert">
                              <i class="material-icons">help</i>
                              <p class="alert-text">
                                {{ trans('Final retail price : ', {}, 'AdminProducts') }}
                                <strong><span id="final_retail_price_ti"></span> {{ trans('tax incl.', [], 'AdminProducts') }}</strong> /
                                <span id="final_retail_price_te"></span> {{ trans('tax excl.', [], 'AdminProducts') }}
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="row">
                      <div class="col-md-12">
                        <h2>{{ trans('Cost price', {}, 'AdminProducts') }}</h2>
                      </div>
                      <div class="col-md-2 form-group">
                        <label>{{ form.step2.wholesale_price.vars.label|raw }}</label>
                        {{ form_errors(form.step2.wholesale_price) }}
                        {{ form_widget(form.step2.wholesale_price) }}
                      </div>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="row">
                      <div class="col-md-12">
                        <h2>{{ trans('Specific prices', {}, 'AdminProducts') }}</h2>
                      </div>
                      <div class="col-md-12">
                        <div id="specific-price" class="m-b-2">
                          <table id="js-specific-price-list" class="table table-striped hide" data="{{ path('admin_specific_price_list') }}" data-action-delete="{{ path('admin_delete_specific_price') }}">
                            <thead>
                            <tr>
                              <th>{{ trans('Rule', {}, 'AdminProducts') }}</th>
                              <th>{{ trans('Combination', {}, 'AdminProducts') }}</th>
                              <th>{{ trans('Currency', {}, 'AdminProducts') }}</th>
                              <th>{{ trans('Country', {}, 'AdminProducts') }}</th>
                              <th>{{ trans('Group', {}, 'AdminProducts') }}</th>
                              <th>{{ trans('Customer', {}, 'AdminProducts') }}</th>
                              <th>{{ trans('Fixed price', {}, 'AdminProducts') }}</th>
                              <th>{{ trans('Impact', {}, 'AdminProducts') }}</th>
                              <th>{{ trans('Period', {}, 'AdminProducts') }}</th>
                              <th>{{ trans('From', {}, 'AdminProducts') }}</th>
                              <th></th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                          </table>
                          <a class="btn btn-action" data-toggle="collapse" href="#specific_price_form" aria-expanded="false">
                            <i class="material-icons">add</i>
                            {{ trans('Add a specific price', {}, 'AdminProducts') }}
                          </a>
                        </div>
                        <div class="collapse" id="specific_price_form" data-action="{{ path('admin_specific_price_add') }}">
                          {{ include('PrestaShopBundle:Admin:Product/Include/form-specific-price.html.twig', {'form': form.step2.specific_price, 'is_multishop_context': is_multishop_context}) }}
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-12">
                    <div class="row">
                      <div class="col-md-12">
                        <h2>{{ trans('Priority management', {}, 'AdminProducts') }}</h2>
                      </div>
                      <div class="col-md-12">
                        <div class="alert alert-info" role="alert">
                          <i class="material-icons">help</i>
                          <p class="alert-text">
                            {{ trans('Sometimes one customer can fit into multiple price rules. Priorities allow you to define wich rule applies to the customer.', {}, 'AdminProducts') }}
                          </p>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <fieldset class="form-group">
                          <label>{{ trans('Priorities', {}, 'AdminProducts') }}</label>
                          {{ form_errors(form.step2.specificPricePriority_0) }}
                          {{ form_widget(form.step2.specificPricePriority_0) }}
                        </fieldset>
                      </div>
                      <div class="col-md-3">
                        <fieldset class="form-group">
                          <label>&nbsp;</label>
                          {{ form_errors(form.step2.specificPricePriority_1) }}
                          {{ form_widget(form.step2.specificPricePriority_1) }}
                        </fieldset>
                      </div>
                      <div class="col-md-3">
                        <fieldset class="form-group">
                          <label>&nbsp;</label>
                          {{ form_errors(form.step2.specificPricePriority_2) }}
                          {{ form_widget(form.step2.specificPricePriority_2) }}
                        </fieldset>
                      </div>
                      <div class="col-md-3">
                        <fieldset class="form-group">
                          <label>&nbsp;</label>
                          {{ form_errors(form.step2.specificPricePriority_3) }}
                          {{ form_widget(form.step2.specificPricePriority_3) }}
                        </fieldset>
                      </div>
                      <div class="col-md-12">
                        {{ form_widget(form.step2.specificPricePriorityToAll) }}
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>

        {# STEP 5 #}
        <div role="tabpanel" class="form-contenttab tab-pane" id="step5">
          <div class="row">
            <div class="col-md-12">
              <div class="container-fluid">
                <div class="row">

                  {{ include('PrestaShopBundle:Admin/Product/Include:form_seo.html.twig', {'form' : form.step5}) }}

                </div>
              </div>
            </div>
          </div>
        </div>

        {# STEP 6 #}
        <div role="tabpanel" class="form-contenttab tab-pane" id="step6">
          <div class="row">
            <div class="col-md-12">
              <div class="container-fluid">
                <div class="row">

                  <div class="col-md-12">

                    <div class="row">
                      <div class="col-md-12">
                        <h2>{{ trans('Visibility', {}, 'AdminProducts') }}</h2>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-4 form-group">
                        {{ form_errors(form.step6.visibility) }}
                        {{ form_widget(form.step6.visibility) }}
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12 form-group">
                          {{ form_errors(form.step6.display_options) }}
                          {{ form_widget(form.step6.display_options.available_for_order) }}
                          {{ form_widget(form.step6.display_options.show_price) }}
                          {{ form_widget(form.step6.display_options.online_only) }}
                      </div>
                    </div>

                    <div class="row form-group">
                      <div class="col-md-8">
                        {{ form_errors(form.step6.tags) }}
                        {{ form_widget(form.step6.tags) }}
                        <div class="alert alert-info m-t-1" role="alert">
                          <i class="material-icons">help</i>
                          <p class="alert-text">
                            {{ trans('Separate each tag by pressing Enter.', {}, 'AdminProducts')|raw }}<br/>
                            {{ trans('Tags are meant to help your customers find your productvia the search bar.', {}, 'AdminProducts')|raw }}<br/>
                            {{ trans('Use terms and keywords that your customers will use to search for this product and make sure you are consistent with the tags you may have already used.', {}, 'AdminProducts')|raw }}<br/>
                            {{ trans('You can manage tag aliases in the %link% section.', {'%link%': '<a href="'~ getAdminLink("AdminSearchConf") ~'">'~trans('Alias', {}, 'AdminProducts')~'</a>'}, 'AdminProducts')|raw }}
                          </p>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12">
                        <h2>{{ trans('Condition & References', {}, 'AdminProducts')|raw }}</h2>
                      </div>
                    </div>

                    <div class="row">
                      <fieldset class="col-md-4 form-group">
                        <label class="form-control-label">{{ form.step6.condition.vars.label }}</label>
                        {{ form_errors(form.step6.condition) }}
                        {{ form_widget(form.step6.condition) }}
                      </fieldset>
                      <fieldset class="col-md-4 form-group">
                        <label class="form-control-label">&nbsp;</label>
                        {{ form_widget(form.step6.show_condition) }}
                      </fieldset>
                    </div>
                    <div class="row">
                      <fieldset class="col-md-4 form-group">
                        <label class="form-control-label">{{ form.step6.reference.vars.label }}</label>
                        {{ form_errors(form.step6.reference) }}
                        {{ form_widget(form.step6.reference) }}
                      </fieldset>
                      <fieldset class="col-md-4 form-group">
                        <label class="form-control-label">{{ form.step6.isbn.vars.label }}</label>
                        {{ form_errors(form.step6.isbn) }}
                        {{ form_widget(form.step6.isbn) }}
                      </fieldset>
                    </div>
                    <div class="row">
                      <fieldset class="col-md-4 form-group">
                        <label class="form-control-label">{{ form.step6.upc.vars.label }}</label>
                        {{ form_errors(form.step6.upc) }}
                        {{ form_widget(form.step6.upc) }}
                      </fieldset>
                      <fieldset class="col-md-4 form-group">
                        <label class="form-control-label">{{ form.step6.ean13.vars.label }}</label>
                        {{ form_errors(form.step6.ean13) }}
                        {{ form_widget(form.step6.ean13) }}
                      </fieldset>
                    </div>

                    <div class="row">
                      <div class="col-md-12">
                        <div id="custom_fields" class="m-b-2">
                          <h2>{{ form.step6.custom_fields.vars.label }}</h2>
                          {{ form_errors(form.step6.custom_fields) }}
                          <ul class="customFieldCollection nostyle" data-prototype="
                                      {% filter escape %}
                                      {{ include('PrestaShopBundle:Admin/Product/Include:form_custom_fields.html.twig', { 'form': form.step6.custom_fields.vars.prototype }) }}
                                      {% endfilter %}">
                            {% for field in form.step6.custom_fields %}
                              <li>
                                {{ include('PrestaShopBundle:Admin/Product/Include:form_custom_fields.html.twig', { 'form': field }) }}
                              </li>
                            {% endfor %}
                          </ul>
                          <a href="#" class="btn btn-action add">
                            <i class="material-icons">add</i>
                            {{ trans('Add a customization field', {}, 'AdminProducts') }}
                          </a>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <h2>{{ trans('Attachments', {}, 'AdminProducts') }}</h2>
                        {{ form_widget(form.step6.attachments) }}
                      </div>
                      <div class="col-md-6">
                        <h2>{{ trans('Create a new attachment', {}, 'AdminProducts') }}</h2>
                        <fieldset class="form-group">
                          {{ form_errors(form.step6.attachment_product) }}
                          <div id="form_step6_attachment_product" data-action="{{ form.step6.attachment_product.vars.attr['data-action'] }}">
                            <div class="form-group">{{ form_widget(form.step6.attachment_product.file) }}</div>
                            <div class="form-group">{{ form_widget(form.step6.attachment_product.name) }}</div>
                            <div class="form-group">{{ form_widget(form.step6.attachment_product.description) }}</div>
                            <div class="form-group">{{ form_widget(form.step6.attachment_product.add) }}</div>
                          </div>
                        </fieldset>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12">
                        <div id="custom_fields">
                          <h2>{{ form.step6.suppliers.vars.label }}</h2>
                          <div class="row">
                            <div class="col-md-12">
                              <div class="alert alert-info" role="alert">
                                <i class="material-icons">help</i>
                                <p>
                                  {{ trans('This interface allows you to specify the suppliers of the current product and eventually its combinations.', {}, 'AdminProducts')|raw }}<br/>
                                  {{ trans('It is also possible to specify supplier references according to previously associated suppliers.', {}, 'AdminProducts')|raw }}
                                </p>
                              </div>
                            </div>
                            {{ form_errors(form.step6.suppliers) }}
                            <div class="col-md-4">
                              <fieldset class="form-group">
                                <label>{{ trans('Choose the suppliers associated with this product', {}, 'AdminProducts') }}</label>
                                {{ form_widget(form.step6.suppliers) }}
                              </fieldset>
                            </div>
                            <div class="col-md-4" id="default_supplier_list">
                              <fieldset class="form-group">
                                <label>{{ trans('Choose a default supplier', {}, 'AdminProducts') }}</label>
                                {{ form_widget(form.step6.default_supplier) }}
                              </fieldset>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div id="supplier_combination_collection" data-url="{{ path('admin_supplier_refresh_product_supplier_combination_form') }}">
                      {{ include('PrestaShopBundle:Admin:Product/Include/form-supplier-combination.html.twig', { 'suppliers': form.step6.suppliers.vars.value, 'form': form.step6 }) }}
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>

        {# OTHER STEPS #}
        {% if hookcount('displayAdminProductsExtra') > 0 %}
          <div role="tabpanel" class="tab-pane panel panel-default" id="hooks">
            <div class="row">
              <div class="col-md-12">
                <div class="container-fluid">
                  <div class="row">

                    {# LEFT #}
                    <div class="col-md-9">
                      {% for module in renderhooksarray('displayAdminProductsExtra', {'id_product': id_product}) %}
                        <div class="card">
                          <div class="card-header">
                            {{ module.name }}
                          </div>
                          <div class="card-block" id="module_{{ module.id }}">
                            {{ module.content|raw }}
                          </div>
                        </div>
                      {% endfor %}
                    </div>

                    <div class="col-md-3">
                      {% render controller('PrestaShopBundle:Admin\\Common:recommendedModules',
                      {'limit': 3, 'randomize': 1, 'domain': 'products_others' })
                      %}
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        {% endif %}

      </div>

      {{ form_widget(form.id_product) }}
      {{ form_widget(form._token) }}

    </div>

    {# FOOTER #}
    <div class="product-footer">
      <div class="col-lg-5">
        <a
          href="{{ path('admin_product_unit_action', {action: 'delete', id: id_product}) }}?redirect_url={{ path('admin_product_catalog') }}"
          class="btn btn-invisible btn-lg delete"
          data-toggle="tooltip"
          id="product_form_delete_btn"
          title="{{ trans('Permanently delete this product.', {}, 'AdminProducts') }}"
        >
          <i class="material-icons">delete</i>
        </a>
        <a
          data-redirect="{{ preview_link }}"
          target="_blank"
          class="btn btn-default btn-submit hidden-xs"
          data-toggle="tooltip"
          id="product_form_preview_btn"
          title="{{ trans('View the product draft on the site.', {}, 'AdminProducts') }}"
         >
          {{ trans('Preview', {}, 'AdminProducts') }}
        </a>

        <h2 class="for-switch online-title" {% if not form.step1.vars.value.active %}style="display:none;"{% endif %}>{{ trans('Online', {}, 'AdminProducts') }}</h2>
        <h2 class="for-switch offline-title" {% if form.step1.vars.value.active %}style="display:none;"{% endif %}>{{ trans('Offline', {}, 'AdminProducts') }}</h2>
        <input
          id="form_step1_active"
          data-toggle="switch"
          type="checkbox"
          name="form[step1][active]"
          value="1"
          {{ form.step1.vars.value.active ? 'checked="checked"' : '' }}
        />

      </div>
      <div class="col-lg-7 text-lg-right">
        <button
          type="button"
          class="btn btn-primary-outline btn-submit hidden-xs uppercase duplicate"
          id="product_form_save_duplicate_btn"
          data-redirect="{{ path('admin_product_unit_action', {action: 'duplicate', id: id_product}) }}?redirect_url={{ path('admin_product_catalog') }}"
          data-toggle="tooltip"
          title="{{ trans('Save and duplicate (CTRL+D) the current product, then go to the new product.', {}, 'AdminProducts') }}"
          >
          {{ trans('Duplicate', {}, 'AdminProducts')|raw }}
        </button>
        <button
          type="button"
          class="btn btn-primary-outline btn-submit hidden-xs uppercase go-catalog"
          id="product_form_save_go_to_catalog_btn"
          data-redirect="{{ path('admin_product_catalog', {'offset': 'last', 'limit': 'last'}) }}"
          data-toggle="tooltip" title="{{ trans('Save and go back to the catalog (CTRL+Q)', {}, 'AdminProducts') }}"
          >
          {{ trans('Go to catalog', {}, 'AdminProducts')|raw }}
        </button>
        <button
          type="button"
          class="btn btn-primary-outline btn-submit hidden-xs uppercase new-product"
          id="product_form_save_new_btn"
          data-redirect="{{ path('admin_product_new') }}"
          data-toggle="tooltip"
          title="{{ trans('Save and create (CTRL+P) a new product.', {}, 'AdminProducts') }}"
          >
          {{ trans('Add new product', {}, 'AdminProducts')|raw }}
        </button>
        <input
          id="submit"
          type="submit"
          class="btn btn-primary btn-lg uppercase"
          value="{{ trans('Save', {}, 'AdminProducts') }}"
          data-toggle="tooltip"
          title="{{ trans('Save (CTRL+S) the product and stay on the current page.', {}, 'AdminProducts') }}"
          />
      </div>
    </div>

  </form>


  {% embed 'PrestaShopBundle:Admin/Helpers:bootstrap_popup.html.twig' with {
    'id': 'confirmation_modal',
    'title': trans("Warning", {}, 'AdminTabs'),
    'closable': false,
    'actions': [
      {
        'type': 'button',
        'label': trans("Yes", {}, 'AdminTabs'),
        'class': 'btn btn-danger continue'
      },{
        'type': 'button',
        'label': trans("No", {}, 'AdminTabs'),
        'class': 'btn btn-default cancel'
      }
    ],
  } %}
    {% block content %}
      <div class="modal-body"></div>
    {% endblock %}
  {% endembed %}

{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('themes/default/css/bundle/module/module.css') }}" />
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script src="{{ asset('themes/default/js/bundle/product/form.js') }}"></script>
  <script src="{{ asset('themes/default/js/bundle/product/product-category-tags.js') }}"></script>
  <script src="{{ asset('themes/default/js/bundle/category-tree.js') }}"></script>
  <script src="{{ asset('themes/default/js/bundle/module/module_card.js') }}"></script>
  <script src="{{ asset('../js/tiny_mce/tiny_mce.js') }}"></script>
  <script src="{{ asset('../js/admin/tinymce.inc.js') }}"></script>
  <script src="{{ asset('../js/admin/tinymce_loader.js') }}"></script>
{% endblock %}

{% set js_translatable = {
"Form update success": trans("Form update success", {}, 'AdminProducts'),
"Form update errors": trans("Form update errors", {}, 'AdminProducts'),
"Delete": trans("Delete", {}, 'AdminProducts'),
"ToLargeFile": trans("The file is too large ({{filesize}}). Allowed maximum size is {{maxFilesize}}.", {}, 'AdminProducts'),
"Drop images here": trans("Drop images here", {}, 'AdminProducts'),
"or select files": trans("or select files", {}, 'AdminProducts'),
"files recommandations": trans("Recommanded size 800 x 800px for default theme.", {}, 'AdminProducts'),
"files recommandations2": trans("JPG, GIF or PNG format.", {}, 'AdminProducts'),
"Cover": trans("Cover", {}, 'AdminProducts'),
"Are you sure to disable variations ? they will all be deleted": trans("Are you sure to disable variations ? they will all be deleted", {}, 'AdminProducts'),
"Are you sure to delete this?": trans("Are you sure to delete this?", {}, 'AdminProducts'),
"Quantity": trans("Quantity", {}, 'AdminProducts'),
"Combinations": trans("Combinations", {}, 'AdminProducts'),
"Virtual product": trans("Virtual product", {}, 'AdminProducts'),
"tax incl.": trans("tax incl.", {}, 'AdminProducts'),
"tax excl.": trans("tax excl.", {}, 'AdminProducts'),
"You can't create pack product with variations. Are you sure to disable variations ? they will all be deleted.": trans("You can't create pack product with variations. Are you sure to disable variations ? they will all be deleted.", {}, "AdminProducts"),
"You can't create virtual product with variations. Are you sure to disable variations ? they will all be deleted.": trans("You can't create virtual product with variations. Are you sure to disable variations ? they will all be deleted.", {}, "AdminProducts"),
}|merge(js_translatable) %}
