{#**
 * Copyright since 2007 PrestaShop SA and Contributors
 * PrestaShop is an International Registered Trademark & Property of PrestaShop SA
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.md.
 * It is also available through the world-wide-web at this URL:
 * https://opensource.org/licenses/OSL-3.0
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@prestashop.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade PrestaShop to newer
 * versions in the future. If you wish to customize PrestaShop for your
 * needs please refer to https://devdocs.prestashop.com/ for more information.
 *
 * @author    PrestaShop SA and Contributors <contact@prestashop.com>
 * @copyright Since 2007 PrestaShop SA and Contributors
 * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)
 *#}
{% extends '@PrestaShop/Admin/layout.html.twig' %}
{% trans_default_domain "Admin.Design.Feature" %}

{% block content %}
<div class='container'>
  <div class="row m-0">
    {% if not canMove %}
      <p class="alert alert-warning alert-can-move">
        {{ 'If you want to order/move the following data, please select a shop from the shop list.' | trans({}, 'Admin.Design.Notification') }}
      </p>
    {% endif %}

      <form class="mt-3 container" id="position-filters">
          <div class="mt-3">
            <div class="row">
              <div class="col-md-4">
               <h3>{{ 'Show' | trans({}, 'Admin.Actions') }}</h3>
               <select id='show-modules' class="filter">
                   <option value="all">{{ 'All modules' | trans }}&nbsp;</option>
                   {% for module in modules %}
                       <option value="{{ module.id }}"{% if selectedModule == module.id %} selected="selected"{% endif %}>{{ module.displayName }}</option>
                   {% endfor %}
               </select>
             </div>
             <div class="col-md-8">
                <h3>{{ 'Search for a hook' | trans }}</h3>
                <div class="input-group">
                  <input type="text" class="form-control" id="hook-search" name="hook-search" placeholder="">
                  <button type='button' class="btn btn-primary float-right search-button">
                    <i class="material-icons">search</i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-3">
            <div class="row">
              <div class="col-md-12">
                <p class="checkbox">
                  <label class="form-control-label" for="hook-position">
                  <input type="checkbox" id="hook-position" />
                  <label class="selectbox" for="hook-position"><i class="material-icons done">done</i></label>
                    {{ 'Display non-positionable hooks' | trans }}
                  </label>
                </p>
              </div>
            </div>
          </div>
        </form>
        <form
            id="module-positions-form"
            method="post"
            action="{{ path('admin_modules_positions_form_actions_status') }}"
            data-update-url="{{ path('api_improve_design_positions_update') }}"
            data-togglestatus-url="{{ path('admin_modules_positions_toggle_status') }}"
        >
        {% if canMove %}
            <div class="btn-group pl-10" id='group-bulk-actions'>
                <button
                    class="btn btn-secondary dropdown-toggle hooks-bulk-action"
                    type="button"
                    id="dropdownMenuButtonFormActions"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                    disabled
                >
                    {{ 'Bulk actions' | trans({}, 'Admin.Global') }}
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButtonFormActions">
                    <p class="text-center mt-1">
                        <span id="modules-position-selection-count"></span> {{ 'modules selected' | trans({}, 'Admin.Design.Feature') }}
                    </p>
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item btn btn-default" name="form_action" value="enable" form="module-positions-form">
                        <i class="material-icons">radio_button_checked</i>{{ 'Activate selection' | trans({}, 'Admin.Actions') }}
                    </button>
                    <button class="dropdown-item btn btn-default" name="form_action" value="disable" form="module-positions-form">
                        <i class="material-icons">radio_button_unchecked</i>{{ 'Deactivate selection' | trans({}, 'Admin.Actions') }}
                    </button>
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item btn btn-default" name="form_action" value="unhook" form="module-positions-form">
                        <i class="material-icons">remove_circle</i>{{ 'Unkook selection' | trans({}, 'Admin.Actions') }}
                    </button>
                </div>
            </div>
          {% endif %}
          {% for hook in hooks %}
            <section class="hook-panel{% if not hook['position'] %} hook-position{% endif %}"{% if not hook['position'] %} style="display:none;"{% endif %}>
            <div class="card">
                <div class="card-body">
              <a name="{{ hook['name'] }}"></a>
              <header class="hook-panel-header mb-4">
                <span class="hook-status">
                   <input
                      class="switch-input-md hook-switch-action"
                      data-toggle="switch"
                      data-hook-id="{{ hook['id_hook'] }}"
                      type="checkbox"
                      value="{{ hook['active'] }}"
                      {{ hook['active'] ? 'checked="checked"' : '' }}
                    />
                </span>
                <span class="hook-name">{{ hook['name'] }}</span>
                <label class="badge badge-pill float-right">
                  {% if hook['modules_count'] and canMove %}
                    <input type="checkbox" class="hook-checker" id="Ghook{{ hook['id_hook'] }}" data-hook-id="{{ hook['id_hook'] }}" />
                    <label class="selectbox" for="Ghook{{ hook['id_hook'] }}"><i class="material-icons done">done</i></label>
                  {% endif %}

                  {{ hook['modules_count'] }}
                  {{ ((hook['modules_count'] > 1) ? 'Modules' : 'Module') | trans({}, 'Admin.Global') }}
                </label>

                {% if hook['description'] is defined %}
                  <div class="hook_description">{{ hook['description'] }}</div>
                {% endif %}
              </header>

              {% if hook['modules_count'] %}
                <section class="module-list{% if not hook['active'] %}-disabled{% endif %}">
                  <ul class="list-unstyled{% if hook['modules_count'] > 1 %} sortable{% endif %}">
                    {% for module in hook['modules'] if modules[module['id_module']] is defined %}
                      {% set moduleInstance = modules[module['id_module']] %}
                      <li id="{{ hook['id_hook'] ~ '_' ~ moduleInstance.id }}"
                        class="module-position-{{ moduleInstance.id }} module-item{% if canMove and hook['modules_count'] >= 2 %} draggable{% endif %}">

                        <div class="module-column-select">
                          <i class="material-icons drag_indicator">drag_indicator</i>
                          <input type="checkbox" id="selecterbox{{ hook['id_hook'] ~ '_' ~ moduleInstance.id }}" data-hook-id="{{ hook['id_hook'] }}" class="modules-position-checkbox hook{{ hook['id_hook'] }}" name="unhooks[]" value="{{ hook['id_hook'] ~ '_' ~ moduleInstance.id }}"/>
                          <label class="selectbox" for="selecterbox{{ hook['id_hook'] ~ '_' ~ moduleInstance.id }}"><i class="material-icons done">done</i></label>
                        </div>

                        <div class="module-column-icon">
                          <img src="{{ asset('../modules/' ~ moduleInstance.name ~ '/logo.png') }}" alt="{{ moduleInstance.displayName| escape }}" />
                        </div>

                        <div class="module-column-infos">
                          <span class="module-name">
                            {{ moduleInstance.displayName| escape }}
                            {% if moduleInstance.version %}
                              <small class="text-muted">&nbsp;-&nbsp;{{ 'v%s' | format(moduleInstance.version) }}</small>
                            {% endif %}
                          </span>
                        </div>

                        <div class="module-column-description{% if not selectedModule and hook['modules_count'] > 1 %} hasColumnPosition{% endif %} d-none d-md-table-cell">
                          <span class="module-description">{{ moduleInstance.description | escape }}</span>
                        </div>

                        {% if not selectedModule and hook['modules_count'] > 1 %}
                          <div class="btn-toolbar text-center module-column-position{% if canMove and hook['modules_count'] >= 2 %} dragHandle{% endif %}" id="td_{{ hook['id_hook'] ~ '_' ~ moduleInstance.id }}">
                            <div class="btn-group">
                              <span class="index-position">{{ loop.index }}</span>
                            </div>
                          </div>
                        {% endif %}

                        <div class="module-column-actions">
                          <div class="btn-group">
                            {% set linkParams = {
                              'id_module': moduleInstance.id,
                              'id_hook': hook['id_hook'],
                              'editGraft': 1
                            } %}
                            {% if selectedModule %}
                              {% set linkParams = linkParams|merge({'show_modules': selectedModule}) %}
                            {% endif %}

                            <span class="hook-module-status">
                               <input
                                  class="switch-input-md hook-module-switch-action"
                                  data-toggle="switch"
                                  data-hook-id="{{ hook['id_hook'] }}"
                                  data-module-id="{{ moduleInstance.id }}"
                                  data-togglestatus-url="{{ path('admin_modules_positions_toggle_hookmodule_status') }}"
                                  type="checkbox"
                                  value="{{ module['active_in_hook'] }}"
                                  {{ module['active_in_hook'] ? 'checked="checked"' : '' }}
                                />
                            </span>

                            <a
                                class="btn tooltip-link"
                                href="{{ getAdminLink('AdminModulesPositions', true, linkParams) }}"
                                data-toggle="pstooltip"
                                data-placement="top"
                                title="{{ 'Edit' | trans({}, 'Admin.Actions') }}"
                                data-original-title="{{ 'Edit' | trans({}, 'Admin.Actions') }}"
                            >
                              <i class="material-icons">edit</i>
                            </a>

                            <a
                                class="dropdown-item"
                                href="{{ path('admin_modules_positions_unhook', {moduleId: moduleInstance.id, hookId: hook['id_hook']}) }}"
                                data-toggle="pstooltip"
                                data-placement="top"
                                title="{{ 'Unhook' | trans({}, 'Admin.Design.Feature') }}"
                                data-original-title="{{ 'Unhook' | trans({}, 'Admin.Design.Feature') }}"
                            >
                                <i class="material-icons">remove_circle</i>
                            </a>
                          </div>
                        </div>

                        <div class="module-column-description d-block d-md-none w-100">
                          <span class="module-description">{{ moduleInstance.description | escape }}</span>
                        </div>
                      </li>
                    {% endfor %}
                  </ul>
                      </div>
                   </div>
                </section>
              {% endif %}
            </section>
          {% endfor %}
        </form>
  </div>
</div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script src="{{ asset('themes/new-theme/public/improve_design_positions.bundle.js') }}"></script>
{% endblock %}
