{#**
 * Copyright since 2007 PrestaShop SA and Contributors
 * PrestaShop is an International Registered Trademark & Property of PrestaShop SA
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.md.
 * It is also available through the world-wide-web at this URL:
 * https://opensource.org/licenses/OSL-3.0
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@prestashop.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade PrestaShop to newer
 * versions in the future. If you wish to customize PrestaShop for your
 * needs please refer to https://devdocs.prestashop.com/ for more information.
 *
 * @author    PrestaShop SA and Contributors <contact@prestashop.com>
 * @copyright Since 2007 PrestaShop SA and Contributors
 * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)
 *#}

<div class="product-header-details">
{% block header_summary %}
  <div class="product-header-summary">
    <div class="product-field-preview">
      <div class="product-field-value">
        {# It is important to use vars.data and not vars.value because value contains the localized value which may
         # not be written with numeric characters anymore depending on the language but data is the initial float data.
         #}
        {{ productForm.pricing.retail_price.price_tax_excluded.vars.data|price_format }}
      </div>
      <div class="product-field-label">
        {{ 'tax excl.'|trans({}, 'Admin.Global') }}
      </div>
    </div>

    <div class="product-field-preview">
      <div class="product-field-value">
        {{ productForm.pricing.retail_price.price_tax_included.vars.data|price_format }}
      </div>
      <div class="product-field-label">
        {# First find the selected tax rate #}
        {% set taxRate = 0 %}
        {% for group_label, choice in productForm.pricing.tax_rules_group_id.vars.choices %}
          {% if choice is selectedchoice(productForm.pricing.tax_rules_group_id.vars.value) %}
            {% set taxRate = choice.attr['data-tax-rate'] %}
          {% endif %}
        {% endfor %}

        {# If tax rate is defined display it in the label #}
        {% if taxRate %}
          {{ 'tax incl. (tax rule: %taxRate%%)'|trans({'%taxRate%': taxRate|round(2)}, 'Admin.Catalog.Feature') }}
        {% else %}
          {{ '(tax rule: %taxRate%%)'|trans({'%taxRate%': taxRate|round(2)}, 'Admin.Catalog.Feature') }}
        {% endif %}
      </div>
    </div>

    {% if productForm.stock.quantities.delta_quantity is defined %}
      {% set quantityData = productForm.stock.quantities.delta_quantity.quantity.vars.data %}
      {% set quantityValue = productForm.stock.quantities.delta_quantity.quantity.vars.value %}
      {% set lowStock = productForm.stock.options.low_stock_threshold.vars.data %}

      {% if quantityData <= 0 %}
        {% set stockClass = 'danger' %}
        {# Use custom labels if available #}
        {% set availableLaterLabels = productForm.stock.availability.available_later_label.vars.value %}
        {% if availableLaterLabels[languageId] is defined and availableLaterLabels[languageId] is not empty %}
          {% set stockLabel = availableLaterLabels[languageId] %}
        {% else %}
          {% set stockLabel = 'out of stock'|trans({}, 'Admin.Catalog.Feature') %}
        {% endif %}
      {% elseif lowStock > 0 and quantityData < lowStock %}
        {% set stockClass = 'warning' %}
        {% set stockLabel = 'low stock'|trans({}, 'Admin.Catalog.Feature') %}
      {% else %}
        {% set stockClass = 'success' %}
        {# Use custom labels if available #}
        {% set availableNowLabels = productForm.stock.availability.available_now_label.vars.value %}
        {% if availableNowLabels[languageId] is defined and availableNowLabels[languageId] is defined is not empty %}
          {% set stockLabel = availableNowLabels[languageId] %}
        {% else %}
          {% set stockLabel = 'in stock'|trans({}, 'Admin.Catalog.Feature') %}
        {% endif %}
      {% endif %}

      <div class="product-field-preview">
        <div class="product-field-value {{ stockClass }}">
          {{ quantityValue }}
        </div>
        <div class="product-field-label">
          {{ stockLabel }}
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %}

{% block header_references %}
  {% set referencesForm = productForm.specifications.references %}
  <div class="product-header-references">
    {% for child in referencesForm.children %}
      {% if child.vars.value is not empty %}
        <div class="product-reference">
          <label>{{ child.vars.label }}</label>
          <span>{{ child.vars.value }}</span>
        </div>
      {% endif %}
    {% endfor %}
  </div>
{% endblock %}
</div>
