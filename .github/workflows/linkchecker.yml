name: Docker Image CI

on: [push]

jobs:

  build:

    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Build the docker-compose stack
        run: cd ./tests/puppeteer/ && docker-compose -f docker-compose.nightly.yml -f docker-compose.tests.yml up -d --build --force-recreat
      - name: Sleep
        uses: jakejarvis/wait-action@master
        with:
          time: '60s'
      - name: Build the docker-compose stack
        run: cd ./tests/puppeteer/ && docker-compose -f docker-compose.nightly.yml -f docker-compose.tests.yml exec -T tests /tmp/wait-for-it.sh --timeout=720 --strict prestashop-web:80
        
      - name: Build the docker-compose stack
        run: cd ./tests/puppeteer/ && docker-compose -f docker-compose.nightly.yml -f docker-compose.tests.yml exec -T -e COMMAND="linkchecker" tests bash /tmp/run-tests.sh
