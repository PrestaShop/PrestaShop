window.order_view=function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};return e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=387)}({16:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventEmitter=void 0;var n=r(18),o=function(t){return t&&t.__esModule?t:{default:t}}(n);e.EventEmitter=new o.default},18:function(t,e,r){"use strict";function n(t){console&&console.warn&&console.warn(t)}function o(){o.init.call(this)}function d(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function a(t,e,r,o){var a,i,u;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(i=t._events,void 0===i?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),i=t._events),u=i[e]),void 0===u)u=i[e]=r,++t._eventsCount;else if("function"==typeof u?u=i[e]=o?[r,u]:[u,r]:o?u.unshift(r):u.push(r),(a=d(t))>0&&u.length>a&&!u.warned){u.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=u.length,n(c)}return t}function i(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,m(this.listener,this.target,t))}function u(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},o=i.bind(n);return o.listener=r,n.wrapFn=o,o}function c(t,e,r){var n=t._events;if(void 0===n)return[];var o=n[e];return void 0===o?[]:"function"==typeof o?r?[o.listener||o]:[o]:r?p(o):l(o,o.length)}function s(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function l(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function f(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function p(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}var h,v="object"==typeof Reflect?Reflect:null,m=v&&"function"==typeof v.apply?v.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};h=v&&"function"==typeof v.ownKeys?v.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var _=Number.isNaN||function(t){return t!==t};t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var g=10;Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(t){if("number"!=typeof t||t<0||_(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");g=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||_(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return d(this)},o.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n="error"===t,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){var d;if(e.length>0&&(d=e[0]),d instanceof Error)throw d;var a=new Error("Unhandled error."+(d?" ("+d.message+")":""));throw a.context=d,a}var i=o[t];if(void 0===i)return!1;if("function"==typeof i)m(i,this,e);else for(var u=i.length,c=l(i,u),r=0;r<u;++r)m(c[r],this,e);return!0},o.prototype.addListener=function(t,e){return a(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return a(this,t,e,!0)},o.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,u(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,u(this,t,e)),this},o.prototype.removeListener=function(t,e){var r,n,o,d,a;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(o=-1,d=r.length-1;d>=0;d--)if(r[d]===e||r[d].listener===e){a=r[d].listener,o=d;break}if(o<0)return this;0===o?r.shift():f(r,o),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,a||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var o,d=Object.keys(r);for(n=0;n<d.length;++n)"removeListener"!==(o=d[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},o.prototype.listeners=function(t){return c(this,t,!0)},o.prototype.rawListeners=function(t){return c(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):s.call(t,e)},o.prototype.listenerCount=s,o.prototype.eventNames=function(){return this._eventsCount>0?h(this._events):[]}},283:function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),d=r(43),a=function(t){return t&&t.__esModule?t:{default:t}}(d),i=window.$,u=function(){function t(){return n(this,t),this._initShowNoteFormEventHandler(),this._initCloseNoteFormEventHandler(),this._initEnterPaymentEventHandler(),{}}return o(t,[{key:"_initShowNoteFormEventHandler",value:function(){i(".js-open-invoice-note-btn").on("click",function(t){t.preventDefault(),i(t.currentTarget).closest("tr").siblings("tr:first").removeClass("d-none")})}},{key:"_initCloseNoteFormEventHandler",value:function(){i(".js-cancel-invoice-note-btn").on("click",function(t){i(t.currentTarget).closest("tr").addClass("d-none")})}},{key:"_initEnterPaymentEventHandler",value:function(){i(".js-enter-payment-btn").on("click",function(t){var e=i(t.currentTarget),r=e.data("payment-amount");i(a.default.viewOrderPaymentsBlock).get(0).scrollIntoView({behavior:"smooth"}),i(a.default.orderPaymentFormAmountInput).val(r)})}}]),t}();e.default=u},284:function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),d=r(43),a=function(t){return t&&t.__esModule?t:{default:t}}(d),i=window.$,u=function(){function t(){n(this,t),this._initOrderShippingUpdateEventHandler()}return o(t,[{key:"_initOrderShippingUpdateEventHandler",value:function(){i(a.default.showOrderShippingUpdateModalBtn).on("click",function(t){var e=i(t.currentTarget);i(a.default.updateOrderShippingTrackingNumberInput).val(e.data("order-tracking-number")),i(a.default.updateOrderShippingCurrentOrderCarrierIdInput).val(e.data("order-carrier-id"))})}}]),t}();e.default=u},286:function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),d=r(31),a=function(t){return t&&t.__esModule?t:{default:t}}(d),i=window.$,u=function(){function t(e){n(this,t),this.router=new a.default,this.input=e,this.results={},this.dropdown=i('<div class="dropdown"></div>'),this.dropdownMenu=i('<div class="dropdown-menu"></div>'),this.dropdown.html(this.dropdownMenu),this.input.after(this.dropdown),this.onItemClickedCallback=function(){}}return o(t,[{key:"listenForSearch",value:function(){var t=this;this.input.on("click",function(e){e.stopImmediatePropagation(),t.updateResults(t.results)}),this.input.on("keyup",function(e){return t.search(e.target.value)}),i(document).on("click",function(){return t.dropdownMenu.hide()})}},{key:"search",value:function(t){var e=this;i.ajax(this.router.generate("admin_products_search",{search_phrase:t}),{method:"GET"}).then(function(t){return e.updateResults(t)})}},{key:"updateResults",value:function(t){var e=this;this.results=t,this.dropdownMenu.empty(),Object.entries(this.results).forEach(function(t){var r=i('<a class="dropdown-item" data-id="'+t[1].product_id+'" href="#">'+t[1].name+"</a>");r.on("click",function(t){return e.onItemClicked(i(t.target).attr("data-id"))}),e.dropdownMenu.append(r)}),this.dropdownMenu.toggle(Object.keys(this.results).length>0)}},{key:"onItemClicked",value:function(t){this.input.val(this.results[t].name),this.onItemClickedCallback(this.results[t])}}]),t}();e.default=u},287:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(31),i=n(a),u=r(43),c=n(u),s=r(16),l=r(68),f=n(l),p=window.$,h=function(){function t(){o(this,t),this.router=new i.default,this.productAddActionBtn=p(c.default.productAddActionBtn),this.productIdInput=p(c.default.productAddIdInput),this.combinationsBlock=p(c.default.productAddCombinationsBlock),this.combinationsSelect=p(c.default.productAddCombinationsSelect),this.priceTaxIncludedInput=p(c.default.productAddPriceTaxInclInput),this.priceTaxExcludedInput=p(c.default.productAddPriceTaxExclInput),this.taxRateInput=p(c.default.productAddTaxRateInput),this.quantityInput=p(c.default.productAddQuantityInput),this.availableText=p(c.default.productAddAvailableText),this.available=null,this.setupListener(),this.product={}}return d(t,[{key:"setupListener",value:function(){var t=this;this.combinationsSelect.on("change",function(e){t.priceTaxExcludedInput.val(p(e.currentTarget).find(":selected").attr("data-price-tax-excluded")),t.priceTaxIncludedInput.val(p(e.currentTarget).find(":selected").attr("data-price-tax-included")),t.available=p(e.currentTarget).find(":selected").attr("data-stock"),t.quantityInput.trigger("change")}),this.quantityInput.on("change keyup",function(e){if(null!==t.available){var r=parseInt(e.target.value?e.target.value:0,10),n=t.available-r;t.availableText.text(n),t.availableText.toggleClass("text-danger font-weight-bold",n<0)}}),this.productIdInput.on("change",function(){t.productAddActionBtn.removeAttr("disabled")}),this.priceTaxIncludedInput.on("change keyup",function(e){var r=parseFloat(e.target.value);(r<0||isNaN(r))&&(r=0);var n=t.taxRateInput.val()/100+1;t.priceTaxExcludedInput.val(ps_round(r/n,2))}),this.priceTaxExcludedInput.on("change keyup",function(e){var r=parseFloat(e.target.value);(r<0||isNaN(r))&&(r=0);var n=t.taxRateInput.val()/100+1;t.priceTaxIncludedInput.val(ps_round(r*n,2))}),this.productAddActionBtn.on("click",function(e){return t.addProduct(p(e.currentTarget).data("order-id"))})}},{key:"setProduct",value:function(t){this.productIdInput.val(t.product_id).trigger("change"),this.priceTaxExcludedInput.val(t.price_tax_excl),this.priceTaxIncludedInput.val(t.price_tax_incl),this.taxRateInput.val(t.tax_rate),this.available=t.stock,this.quantityInput.val(1),this.quantityInput.trigger("change"),this.setCombinations(t.combinations)}},{key:"setCombinations",value:function(t){var e=this;this.combinationsSelect.empty(),Object.entries(t).forEach(function(t){e.combinationsSelect.append('<option value="'+t[1].attribute_combination_id+'" data-price-tax-excluded="'+t[1].price_tax_excluded+'" data-price-tax-included="'+t[1].price_tax_included+'" data-stock="'+t[1].stock+'">'+t[1].attribute+"</option>")}),this.combinationsBlock.toggleClass("d-none",0===Object.keys(t).length)}},{key:"addProduct",value:function(t){var e={product_id:this.productIdInput.val(),combination_id:p(":selected",this.combinationsSelect).val(),price_tax_incl:this.priceTaxIncludedInput.val(),price_tax_excl:this.priceTaxExcludedInput.val(),quantity:this.quantityInput.val()};p.ajax({url:this.router.generate("admin_orders_add_product",{orderId:t}),method:"POST",data:e}).then(function(r){s.EventEmitter.emit(f.default.productAddedToOrder,{orderId:t,orderProductId:e.product_id,newRow:r})})}}]),t}();e.default=h},288:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(390),i=n(a),u=r(43),c=n(u),s=r(68),l=n(s),f=r(16),p=r(391),h=n(p),v=r(388),m=n(v),_=window.$,g=function(){function t(){o(this,t),this.orderProductManager=new i.default,this.orderProductRenderer=new h.default,this.orderPricesRefresher=new m.default}return d(t,[{key:"listenForProductDelete",value:function(){var t=this;_(c.default.productDeleteBtn).unbind("click").on("click",function(e){return t.orderProductManager.handleDeleteProductEvent(e)});var e=function(e){t.orderProductRenderer.removeProductFromList(e.oldOrderDetailId),t.orderPricesRefresher.refresh(e.orderId)};f.EventEmitter.off(l.default.productDeletedFromOrder,e).on(l.default.productDeletedFromOrder,e)}},{key:"listenForProductEdit",value:function(){var t=this;_(c.default.productEditBtn).on("click",function(e){var r=_(e.currentTarget);t.orderProductRenderer.moveProductsPanelToModificationPosition(),t.orderProductRenderer.editProductFromToList(r.attr("data-order-detail-id"),r.attr("data-product-quantity"),r.attr("data-product-price-tax-incl"),r.attr("data-product-price-tax-excl"),r.attr("data-tax-rate"))}),_(c.default.productCancelEditBtn).on("click",function(e){var r=_(e.currentTarget);t.orderProductRenderer.resetEditRow(r.attr("data-order-detail-id")),t.orderProductRenderer.moveProductPanelToOriginalPosition()}),f.EventEmitter.on(l.default.productEditedToOrder,function(e){t.orderProductRenderer.addOrUpdateProductFromToList(e.orderDetailId,e.newRow),t.orderProductRenderer.resetEditRow(e.orderDetailId),t.orderPricesRefresher.refresh(e.orderId),t.orderProductRenderer.moveProductPanelToOriginalPosition(),t.listenForProductDelete(),t.listenForProductEdit()})}},{key:"listenForProductAdd",value:function(){var t=this;_(c.default.productAddBtn).on("click",function(e){return t.orderProductRenderer.moveProductsPanelToModificationPosition()}),_(c.default.productCancelAddBtn).on("click",function(e){return t.orderProductRenderer.moveProductPanelToOriginalPosition()}),f.EventEmitter.on(l.default.productAddedToOrder,function(e){t.orderProductRenderer.addOrUpdateProductFromToList(e.orderProductId,e.newRow),t.orderProductRenderer.resetAddRow(),t.orderPricesRefresher.refresh(e.orderId),t.orderProductRenderer.moveProductPanelToOriginalPosition(),t.listenForProductDelete(),t.listenForProductEdit()})}},{key:"listenForProductPagination",value:function(){var t=this;_(c.default.productsTablePagination).on("click",".page-link",function(e){var r=_(e.currentTarget);t.orderProductManager.paginate(r.attr("data-order-id"),r.attr("data-page"))}),_(c.default.productsTablePaginationNext).on("click",function(e){if(!_(e.currentTarget).hasClass("disabled")){var r=_(c.default.productsTablePagination).find(".active span").get(0);t.orderProductManager.paginate(_(r).attr("data-order-id"),parseInt(_(r).html(),10)+1)}}),_(c.default.productsTablePaginationPrev).on("click",function(e){if(!_(e.currentTarget).hasClass("disabled")){var r=_(c.default.productsTablePagination).find(".active span").get(0);t.orderProductManager.paginate(_(r).attr("data-order-id"),parseInt(_(r).html(),10)-1)}}),f.EventEmitter.on(l.default.productListPaginated,function(e){t.orderProductRenderer.paginate(e.orderId,e.numPage,e.results),t.listenForProductDelete(),t.listenForProductEdit()})}}]),t}();e.default=g},31:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(83),i=n(a),u=r(73),c=n(u),s=window.$,l=function(){function t(){return o(this,t),i.default.setData(c.default),i.default.setBaseUrl(s(document).find("body").data("base-url")),this}return d(t,[{key:"generate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.assign(e,{_token:s(document).find("body").data("token")});return i.default.generate(t,r)}}]),t}();e.default=l},387:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var o=r(43),d=n(o),a=r(284),i=n(a),u=r(283),c=n(u),s=r(288),l=n(s),f=r(286),p=n(f),h=r(287),v=n(h),m=window.$;m(function(){function t(){var t=m(d.default.privateNoteBlock),e=m(d.default.privateNoteToggleBtn),r=e.hasClass("is-opened");r?(e.removeClass("is-opened"),t.addClass("d-none")):(e.addClass("is-opened"),t.removeClass("d-none")),e.find(".material-icons").text(r?"add":"remove")}var e="amount",r="free_shipping";new i.default;var n=new l.default,o=new p.default(m(d.default.productSearchInput)),a=new v.default;n.listenForProductDelete(),n.listenForProductEdit(),n.listenForProductAdd(),n.listenForProductPagination(),o.listenForSearch(),o.onItemClickedCallback=function(t){return a.setProduct(t)},function(){m(d.default.orderPaymentDetailsBtn).on("click",function(t){m(t.currentTarget).closest("tr").next(":first").toggleClass("d-none")})}(),function(){var t=m(d.default.privateNoteSubmitBtn);m(d.default.privateNoteInput).on("input",function(e){var r=m(e.currentTarget).val();t.prop("disabled",!r)})}(),function(){var t=m(d.default.updateOrderStatusActionBtn);m(d.default.updateOrderStatusActionInput).on("change",function(e){var r=m(e.currentTarget).val();t.prop("disabled",parseInt(r,10)===t.data("order-status-id"))})}(),new c.default,m(d.default.privateNoteToggleBtn).on("click",function(e){e.preventDefault(),t()}),function(){var t=m(d.default.addCartRuleModal),n=t.find("form"),o=t.find(d.default.cartRuleHelpText),a=t.find(d.default.addCartRuleInvoiceIdSelect),i=n.find(d.default.addCartRuleValueInput),u=i.closest(".form-group");i.on("change",function(t){var e=m(t.currentTarget).val();m(t.currentTarget).val(e.replace(/,/g,"."))}),n.find(d.default.addCartRuleApplyOnAllInvoicesCheckbox).on("change",function(t){var e=m(t.currentTarget).is(":checked");a.attr("disabled",e)}),n.find(d.default.addCartRuleTypeSelect).on("change",function(t){var n=m(t.currentTarget).val();n===e?o.removeClass("d-none"):o.addClass("d-none"),n===r?(u.addClass("d-none"),i.attr("disabled",!0)):(u.removeClass("d-none"),i.attr("disabled",!1))})}()})},388:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(31),i=n(a),u=r(43),c=n(u),s=window.$,l=function(){function t(){o(this,t),this.router=new i.default}return d(t,[{key:"refresh",value:function(t){s.ajax(this.router.generate("admin_orders_get_prices",{orderId:t})).then(function(t){s(c.default.orderTotal).text(t.orderTotalFormatted),s(c.default.orderProductsTotal).text(t.productsTotalFormatted),s(c.default.orderShippingTotal).text(t.shippingTotalFormatted),s(c.default.orderTaxesTotal).text(t.taxesTotalFormatted)})}}]),t}();e.default=l},389:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(31),i=n(a),u=r(43),c=n(u),s=r(16),l=r(68),f=n(l),p=window.$,h=function(){function t(e){o(this,t),this.router=new i.default,this.orderProductId=e,this.productRow=p("#orderProduct_"+this.orderProductId),this.productRowEdit,this.productEditActionBtn=p(c.default.productEditActionBtn),this.productIdInput=p(c.default.productEditOrderDetailInput),this.priceTaxIncludedInput=p(c.default.productEditPriceTaxInclInput),this.priceTaxExcludedInput=p(c.default.productEditPriceTaxExclInput),this.taxRateInput=p(c.default.productEditTaxRateInput),this.quantityInput=p(c.default.productEditQuantityInput),this.product={}}return d(t,[{key:"setupListener",value:function(){var t=this;this.productRowEdit.find(c.default.productEditPriceTaxInclInput).on("change keyup",function(e){var r=parseFloat(e.target.value);(r<0||isNaN(r))&&(r=0);var n=t.productRowEdit.find(c.default.productEditTaxRateInput).val()/100+1;t.productRowEdit.find(c.default.productEditPriceTaxExclInput).val(ps_round(r/n,2))}),this.productRowEdit.find(c.default.productEditPriceTaxExclInput).on("change keyup",function(e){var r=parseFloat(e.target.value);(r<0||isNaN(r))&&(r=0);var n=t.productRowEdit.find(c.default.productEditTaxRateInput).val()/100+1;t.productRowEdit.find(c.default.productEditPriceTaxInclInput).val(ps_round(r*n,2))}),this.productRowEdit.find(c.default.productEditActionBtn).on("click",function(e){t.editProduct(p(e.currentTarget).attr("data-order-id"),p(e.currentTarget).attr("data-order-detail-id"))})}},{key:"displayProduct",value:function(t){var e=p(c.default.productEditRow).clone(!0);e.find("td:nth-child(1)").html(this.productRow.find("td:nth-child(1)").html()),e.find("td:nth-child(2)").html(this.productRow.find("td:nth-child(2)").html()),e.find(c.default.productEditOrderDetailInput).val(this.orderProductId),e.find(c.default.productEditPriceTaxExclInput).val(t.price_tax_excl),e.find(c.default.productEditPriceTaxInclInput).val(t.price_tax_incl),e.find(c.default.productEditQuantityInput).val(t.quantity),e.find(c.default.productEditTaxRateInput).val(t.tax_rate),e.find(c.default.productEditActionBtn).attr("data-order-detail-id",this.orderProductId),e.find(c.default.productCancelEditBtn).attr("data-order-detail-id",this.orderProductId),e.attr("id","orderProduct_"+this.orderProductId+"_edit"),this.productRow.addClass("d-none").after(e.removeClass("d-none")),this.productRowEdit=p("#orderProduct_"+this.orderProductId+"_edit"),this.setupListener()}},{key:"editProduct",value:function(t,e){var r={price_tax_incl:this.productRowEdit.find(c.default.productEditPriceTaxInclInput).val(),price_tax_excl:this.productRowEdit.find(c.default.productEditPriceTaxInclInput).val(),quantity:this.productRowEdit.find(c.default.productEditQuantityInput).val()};p.ajax({url:this.router.generate("admin_orders_update_product",{orderId:t,orderDetailId:e}),method:"POST",data:r}).then(function(r){s.EventEmitter.emit(f.default.productEditedToOrder,{orderId:t,orderDetailId:e,newRow:r})})}}]),t}();e.default=h},390:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(31),i=n(a),u=r(16),c=r(68),s=n(c),l=window.$,f=function(){function t(){o(this,t),this.router=new i.default}return d(t,[{key:"handleDeleteProductEvent",value:function(t){t.preventDefault();var e=l(t.currentTarget);confirm(e.data("delete-message"))&&this.deleteProduct(e.data("order-id"),e.data("order-detail-id"))}},{key:"deleteProduct",value:function(t,e){l.ajax(this.router.generate("admin_orders_delete_product",{orderId:t,orderDetailId:e}),{method:"POST"}).then(function(){u.EventEmitter.emit(s.default.productDeletedFromOrder,{oldOrderDetailId:e,orderId:t})})}},{key:"paginate",value:function(t,e){var r=8*(e-1);l.ajax(this.router.generate("admin_orders_get_products",{orderId:t}),{method:"GET",data:{offset:r,limit:8}}).then(function(r){u.EventEmitter.emit(s.default.productListPaginated,{orderId:t,numPage:e,results:r})})}}]),t}();e.default=f},391:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(43),i=n(a),u=r(389),c=n(u),s=r(31),l=n(s),f=window.$,p=function(){function t(){o(this,t),this.router=new l.default}return d(t,[{key:"removeProductFromList",value:function(t){var e=f("#orderProduct_"+t);e.hide("fast",function(){return e.remove()});var r=parseInt(f(i.default.productsCount).html(),10);f(i.default.productsCount).html(r-1)}},{key:"addOrUpdateProductFromToList",value:function(t,e){var r=f("#orderProduct_"+t);r.length>0?r.html(f(e).html()):f(i.default.productAddRow).before(f(e).hide().fadeIn());var n=parseInt(f(i.default.productsCount).html(),10);f(i.default.productsCount).html(n+1)}},{key:"editProductFromToList",value:function(t,e,r,n,o){new c.default(t).displayProduct({price_tax_excl:n,price_tax_incl:r,tax_rate:o,quantity:e}),f(i.default.productAddActionBtn).addClass("d-none"),f(i.default.productAddRow).addClass("d-none")}},{key:"moveProductsPanelToModificationPosition",value:function(){var t=f(i.default.productModificationPosition);f(i.default.productsPanel).detach().appendTo(t),t.closest(".row").removeClass("d-none"),f(i.default.productActionBtn).addClass("d-none"),f(i.default.productAddActionBtn).removeClass("d-none"),f(i.default.productAddRow).removeClass("d-none"),f("html,body").animate({scrollTop:0},"slow")}},{key:"moveProductPanelToOriginalPosition",value:function(){f(i.default.productModificationPosition).closest(".row").addClass("d-none"),f(i.default.productsPanel).detach().appendTo(i.default.productOriginalPosition),f(i.default.productActionBtn).removeClass("d-none"),f(i.default.productAddActionBtn).addClass("d-none"),f(i.default.productAddRow).addClass("d-none")}},{key:"resetAddRow",value:function(){f(i.default.productSearchInput).val(""),f(i.default.productAddCombinationsSelect).val(""),f(i.default.productAddPriceTaxExclInput).val(""),f(i.default.productAddPriceTaxInclInput).val(""),f(i.default.productAddQuantityInput).val(""),f(i.default.productAddAvailableText).html("")}},{key:"resetEditRow",value:function(t){var e=f("#orderProduct_"+t);f("#orderProduct_"+t+"_edit").remove(),e.removeClass("d-none")}},{key:"paginate",value:function(t,e,r){var n=this,o=f(i.default.productsTablePagination).find("li.page-item").length-2;f(i.default.productsTablePagination).find(".active").removeClass("active"),f(i.default.productsTablePagination).find('li:has(> [data-page="'+e+'"])').addClass("active"),f(i.default.productsTablePaginationPrev).removeClass("disabled"),1==e&&f(i.default.productsTablePaginationPrev).addClass("disabled"),f(i.default.productsTablePaginationNext).removeClass("disabled"),e==o&&f(i.default.productsTablePaginationNext).addClass("disabled"),f(i.default.productsTable).find('tr[id^="orderProduct_"]').remove(),r.products.forEach(function(e){var r=f(i.default.productTemplateRow).clone();r.attr("id","orderProduct_"+e.orderDetailId),e.imagePath?(r.find("td:nth-child(1) img").attr("src",e.imagePath),r.find("td:nth-child(1) img").attr("alt",e.name)):r.find("td:nth-child(1) img").remove(),r.find("td:nth-child(2) a").attr("href",n.router.generate("admin_product_form",{orderId:e.id})),r.find("td:nth-child(2) p:nth-child(1)").html(e.name),e.supplierReference?r.find("td:nth-child(2) p:nth-child(3)").append(e.supplierReference):r.find("td:nth-child(2) p:nth-child(3)").remove(),e.reference?r.find("td:nth-child(2) p:nth-child(2)").append(e.reference):r.find("td:nth-child(2) p:nth-child(2)").remove(),r.find("td:nth-child(3)").html(e.unitPrice),e.quantity>1?r.find("td:nth-child(4) span.badge").html(e.quantity):r.find("td:nth-child(4) span.badge").replaceWith(e.quantity),r.find("td:nth-child(4) input").val(e.quantity),r.find("td:nth-child(5)").html(e.location),r.find("td:nth-child(6)").html(e.availableQuantity),r.find("td:nth-child(7)").html(e.totalPrice),e.delivered?r.find("td:nth-child(8)").remove():(r.find("td:nth-child(8) a:nth-child(1) i").attr("data-order-detail-id",e.orderDetailId).attr("data-product-quantity",e.quantity).attr("data-product-price-tax-incl",e.unitPriceTaxInclRaw).attr("data-product-price-tax-excl",e.unitPriceTaxExclRaw).attr("data-tax-rate",e.taxRate),r.find("td:nth-child(8) a:nth-child(2)").attr("data-order-id",t).attr("data-order-detail-id",e.orderDetailId)),f(i.default.productAddRow).before(r.removeClass("d-none"))})}}]),t}();e.default=p},43:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),/**
 * 2007-2019 PrestaShop SA and Contributors
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * https://opensource.org/licenses/OSL-3.0
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@prestashop.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade PrestaShop to newer
 * versions in the future. If you wish to customize PrestaShop for your
 * needs please refer to https://www.prestashop.com for more information.
 *
 * @author    PrestaShop SA <contact@prestashop.com>
 * @copyright 2007-2019 PrestaShop SA and Contributors
 * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)
 * International Registered Trademark & Property of PrestaShop SA
 */
e.default={orderPaymentDetailsBtn:".js-payment-details-btn",orderPaymentFormAmountInput:"#order_payment_amount",viewOrderPaymentsBlock:"#view_order_payments_block",privateNoteToggleBtn:".js-private-note-toggle-btn",privateNoteBlock:".js-private-note-block",privateNoteInput:"#private_note_note",privateNoteSubmitBtn:".js-private-note-btn",addCartRuleModal:"#addOrderDiscountModal",addCartRuleApplyOnAllInvoicesCheckbox:"#add_order_cart_rule_apply_on_all_invoices",addCartRuleInvoiceIdSelect:"#add_order_cart_rule_invoice_id",addCartRuleTypeSelect:"#add_order_cart_rule_type",addCartRuleValueInput:"#add_order_cart_rule_value",cartRuleHelpText:".js-cart-rule-value-help",updateOrderStatusActionBtn:"#update_order_status_action_btn",updateOrderStatusActionInput:"#update_order_status_action_input",updateOrderStatusActionForm:"#update_order_status_action_form",showOrderShippingUpdateModalBtn:".js-update-shipping-btn",updateOrderShippingTrackingNumberInput:"#update_order_shipping_tracking_number",updateOrderShippingCurrentOrderCarrierIdInput:"#update_order_shipping_current_order_carrier_id",productOriginalPosition:"#orderProductsOriginalPosition",productModificationPosition:"#orderProductsModificationPosition",productsPanel:"#orderProductsPanel",productsCount:"#orderProductsPanelCount",productDeleteBtn:".js-order-product-delete-btn",productsTable:"#orderProductsTable",productsTablePagination:"#orderProductsTablePagination",productsTablePaginationNext:"#orderProductsTablePaginationNext",productsTablePaginationPrev:"#orderProductsTablePaginationPrev",productEditBtn:".js-order-product-edit-btn",productAddBtn:"#addProductBtn",productActionBtn:".js-product-action-btn",productAddActionBtn:"#addProductActionBtn",productCancelAddBtn:"#cancelAddProductBtn",productAddRow:"#addProductTableRow",productSearchInput:"#addProductSearch",productAddIdInput:"#addProductId",productAddTaxRateInput:"#addProductTaxRate",productAddCombinationsBlock:"#addProductCombinations",productAddCombinationsSelect:"#addProductCombinationId",productAddPriceTaxExclInput:"#addProductPriceTaxExcl",productAddPriceTaxInclInput:"#addProductPriceTaxIncl",productAddQuantityInput:"#addProductQuantity",productAddAvailableText:"#addProductAvailable",productEditActionBtn:".editProductActionBtn",productCancelEditBtn:".cancelEditProductBtn",productEditRow:"#editProductTableRow",productEditTaxRateInput:".editProductTaxRate",productEditOrderDetailInput:".editOrderDetailId",productEditPriceTaxExclInput:".editProductPriceTaxExcl",productEditPriceTaxInclInput:".editProductPriceTaxIncl",productEditQuantityInput:".editProductQuantity",productTemplateRow:"#templateProductTableRow",orderProductsTotal:"#orderProductsTotal",orderDiscountsTotal:"#orderDiscountsTotal",orderWrappingTotal:"#orderWrappingTotal",orderShippingTotal:"#orderShippingTotal",orderTaxesTotal:"#orderTaxesTotal",orderTotal:"#orderTotal"}},68:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),/**
 * 2007-2019 PrestaShop SA and Contributors
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * https://opensource.org/licenses/OSL-3.0
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@prestashop.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade PrestaShop to newer
 * versions in the future. If you wish to customize PrestaShop for your
 * needs please refer to https://www.prestashop.com for more information.
 *
 * @author    PrestaShop SA <contact@prestashop.com>
 * @copyright 2007-2019 PrestaShop SA and Contributors
 * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)
 * International Registered Trademark & Property of PrestaShop SA
 */
e.default={productDeletedFromOrder:"productDeletedFromOrder",productAddedToOrder:"productAddedToOrder",productEditedToOrder:"productEditedToOrder",productListPaginated:"productListPaginated"}},73:function(t,e){t.exports={base_url:"",routes:{admin_product_form:{tokens:[["variable","/","\\d+","id"],["text","/sell/catalog/products"]],defaults:[],requirements:{id:"\\d+"},hosttokens:[],methods:["GET","POST"],schemes:[]},admin_products_search:{tokens:[["text","/sell/catalog/products/search"]],defaults:[],requirements:[],hosttokens:[],methods:["GET"],schemes:[]},admin_cart_rules_search:{tokens:[["text","/sell/catalog/cart-rules/search"]],defaults:[],requirements:[],hosttokens:[],methods:["GET"],schemes:[]},admin_customers_view:{tokens:[["text","/view"],["variable","/","\\d+","customerId"],["text","/sell/customers"]],defaults:[],requirements:{customerId:"\\d+"},hosttokens:[],methods:["GET","POST"],schemes:[]},admin_customers_search:{tokens:[["text","/sell/customers/search"]],defaults:[],requirements:[],hosttokens:[],methods:["GET"],schemes:[]},admin_customers_carts:{tokens:[["text","/carts"],["variable","/","\\d+","customerId"],["text","/sell/customers"]],defaults:[],requirements:{customerId:"\\d+"},hosttokens:[],methods:["GET"],schemes:[]},admin_customers_orders:{tokens:[["text","/orders"],["variable","/","\\d+","customerId"],["text","/sell/customers"]],defaults:[],requirements:{customerId:"\\d+"},hosttokens:[],methods:["GET"],schemes:[]},admin_carts_view:{tokens:[["text","/view"],["variable","/","\\d+","cartId"],["text","/sell/orders/carts"]],defaults:[],requirements:{cartId:"\\d+"},hosttokens:[],methods:["GET"],schemes:[]},admin_carts_info:{tokens:[["text","/info"],["variable","/","\\d+","cartId"],["text","/sell/orders/carts"]],defaults:[],requirements:{cartId:"\\d+"},hosttokens:[],methods:["GET"],schemes:[]},admin_carts_create:{tokens:[["text","/sell/orders/carts/new"]],defaults:[],requirements:[],hosttokens:[],methods:["POST"],schemes:[]},admin_carts_edit_addresses:{tokens:[["text","/addresses"],["variable","/","\\d+","cartId"],["text","/sell/orders/carts"]],defaults:[],requirements:{cartId:"\\d+"},hosttokens:[],methods:["POST"],schemes:[]},admin_carts_edit_carrier:{tokens:[["text","/carrier"],["variable","/","\\d+","cartId"],["text","/sell/orders/carts"]],defaults:[],requirements:{cartId:"\\d+"},hosttokens:[],methods:["POST"],schemes:[]},admin_carts_set_free_shipping:{tokens:[["text","/rules/free-shipping"],["variable","/","\\d+","cartId"],["text","/sell/orders/carts"]],defaults:[],requirements:{cartId:"\\d+"},hosttokens:[],methods:["POST"],schemes:[]},admin_carts_add_cart_rule:{tokens:[["text","/cart-rules"],["variable","/","[^/]++","cartId"],["text","/sell/orders/carts"]],defaults:[],requirements:[],hosttokens:[],methods:["POST"],schemes:[]},admin_carts_delete_cart_rule:{tokens:[["text","/delete"],["variable","/","[^/]++","cartRuleId"],["text","/cart-rules"],["variable","/","[^/]++","cartId"],["text","/sell/orders/carts"]],defaults:[],requirements:[],hosttokens:[],methods:["POST"],schemes:[]},admin_carts_add_product:{tokens:[["text","/products"],["variable","/","\\d+","cartId"],["text","/sell/orders/carts"]],defaults:[],requirements:{cartId:"\\d+",productId:"\\d+"},hosttokens:[],methods:["POST"],schemes:[]},admin_carts_delete_product:{tokens:[["text","/delete-product"],["variable","/","\\d+","cartId"],["text","/sell/orders/carts"]],defaults:[],requirements:{cartId:"\\d+"},hosttokens:[],methods:["POST"],schemes:[]},admin_orders_view:{tokens:[["text","/view"],["variable","/","[^/]++","orderId"],["text","/sell/orders/orders"]],defaults:[],requirements:[],hosttokens:[],methods:[],schemes:[]},admin_orders_duplicate_cart:{tokens:[["text","/duplicate-cart"],["variable","/","\\d+","orderId"],["text","/sell/orders/orders"]],defaults:[],requirements:{orderId:"\\d+"},hosttokens:[],methods:["POST"],schemes:[]},admin_orders_update_product:{tokens:[["variable","/","\\d+","orderDetailId"],["text","/products"],["variable","/","\\d+","orderId"],["text","/sell/orders/orders"]],defaults:[],requirements:{orderId:"\\d+",orderDetailId:"\\d+"},hosttokens:[],methods:["POST"],schemes:[]},admin_orders_add_product:{tokens:[["text","/products"],["variable","/","\\d+","orderId"],["text","/sell/orders/orders"]],defaults:[],requirements:{orderId:"\\d+"},hosttokens:[],methods:["POST"],schemes:[]},admin_orders_delete_product:{tokens:[["text","/delete"],["variable","/","\\d+","orderDetailId"],["text","/products"],["variable","/","\\d+","orderId"],["text","/sell/orders/orders"]],defaults:[],requirements:{orderId:"\\d+",orderDetailId:"\\d+"},hosttokens:[],methods:["POST"],schemes:[]},admin_orders_get_prices:{tokens:[["text","/prices"],["variable","/","\\d+","orderId"],["text","/sell/orders/orders"]],defaults:[],requirements:{orderId:"\\d+"},hosttokens:[],methods:["GET"],schemes:[]},admin_orders_get_products:{tokens:[["text","/products"],["variable","/","\\d+","orderId"],["text","/sell/orders/orders"]],defaults:[],requirements:{orderId:"\\d+"},hosttokens:[],methods:["GET"],schemes:[]}},prefix:"",host:"localhost",port:"",scheme:"http",locale:[]}},83:function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function t(){var e=this;n(this,t),this.setRoutes=function(t){e.routesRouting=t||[]},this.getRoutes=function(){return e.routesRouting},this.setBaseUrl=function(t){e.contextRouting.base_url=t},this.getBaseUrl=function(){return e.contextRouting.base_url},this.setPrefix=function(t){e.contextRouting.prefix=t},this.setScheme=function(t){e.contextRouting.scheme=t},this.getScheme=function(){return e.contextRouting.scheme},this.setHost=function(t){e.contextRouting.host=t},this.getHost=function(){return e.contextRouting.host},this.buildQueryParams=function(t,r,n){var o=new RegExp(/\[]$/);r instanceof Array?r.forEach(function(r,a){o.test(t)?n(t,r):e.buildQueryParams(t+"["+("object"===(void 0===r?"undefined":d(r))?a:"")+"]",r,n)}):"object"===(void 0===r?"undefined":d(r))?Object.keys(r).forEach(function(o){return e.buildQueryParams(t+"["+o+"]",r[o],n)}):n(t,r)},this.getRoute=function(t){var r=e.contextRouting.prefix+t;if(e.routesRouting[r])return e.routesRouting[r];if(!e.routesRouting[t])throw new Error('The route "'+t+'" does not exist.');return e.routesRouting[t]},this.generate=function(t,r,n){var d=e.getRoute(t),a=r||{},i=o({},a),u="_scheme",c="",s=!0,l="";if((d.tokens||[]).forEach(function(e){if("text"===e[0])return c=e[1]+c,void(s=!1);if("variable"!==e[0])throw new Error('The token type "'+e[0]+'" is not supported.');var r=(d.defaults||{})[e[3]];if(0==s||!r||(a||{})[e[3]]&&a[e[3]]!==d.defaults[e[3]]){var n;if((a||{})[e[3]])n=a[e[3]],delete i[e[3]];else{if(!r){if(s)return;throw new Error('The route "'+t+'" requires the parameter "'+e[3]+'".')}n=d.defaults[e[3]]}if(!(!0===n||!1===n||""===n)||!s){var o=encodeURIComponent(n).replace(/%2F/g,"/");"null"===o&&null===n&&(o=""),c=e[1]+o+c}s=!1}else r&&delete i[e[3]]}),""==c&&(c="/"),(d.hosttokens||[]).forEach(function(t){var e;return"text"===t[0]?void(l=t[1]+l):void("variable"===t[0]&&((a||{})[t[3]]?(e=a[t[3]],delete i[t[3]]):d.defaults[t[3]]&&(e=d.defaults[t[3]]),l=t[1]+e+l))}),c=e.contextRouting.base_url+c,d.requirements[u]&&e.getScheme()!==d.requirements[u]?c=d.requirements[u]+"://"+(l||e.getHost())+c:l&&e.getHost()!==l?c=e.getScheme()+"://"+l+c:!0===n&&(c=e.getScheme()+"://"+e.getHost()+c),0<Object.keys(i).length){var f=[],p=function(t,e){var r=e;r="function"==typeof r?r():r,r=null===r?"":r,f.push(encodeURIComponent(t)+"="+encodeURIComponent(r))};Object.keys(i).forEach(function(t){return e.buildQueryParams(t,i[t],p)}),c=c+"?"+f.join("&").replace(/%20/g,"+")}return c},this.setData=function(t){e.setBaseUrl(t.base_url),e.setRoutes(t.routes),"prefix"in t&&e.setPrefix(t.prefix),e.setHost(t.host),e.setScheme(t.scheme)},this.contextRouting={base_url:"",prefix:"",host:"",scheme:""}};t.exports=new a}});